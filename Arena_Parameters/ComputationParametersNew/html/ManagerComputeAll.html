
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ManagerComputeAll</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-11-30"><meta name="DC.source" content="ManagerComputeAll.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">------------------------------Variables---------------------------</a></li><li><a href="#3">-----------------------Parameters----------------</a></li><li><a href="#4">----------------------------------Read Mat Files----------------</a></li><li><a href="#5">--------------------Read Parameters of csv files----------------</a></li><li><a href="#6">----------------------------Select  your list if female or male----------------</a></li><li><a href="#7">--------------------Define object IsSleeping---------------------</a></li><li><a href="#8">--------------------------Define object IsHiding-----------------</a></li><li><a href="#9">-----------------------------Define object IsArena ---------------------------</a></li><li><a href="#10">---------------------------Define object Time---------------------------------</a></li><li><a href="#11">------------------------Define object IsEatingDrinking-----------------------------</a></li><li><a href="#16">Variables</a></li><li><a href="#17">Read excel and matlab files for each nCSV</a></li><li><a href="#19">Create a wait bar for control</a></li><li><a href="#20">Clear the variables</a></li><li><a href="#23">--------Found in the RFID selected data the mouse with 2 identities head or reabs--</a></li><li><a href="#24">---------------------------- Treat with the time-------------------------</a></li><li><a href="#25">In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena</a></li><li><a href="#27">%% ----------Find is sleeping-------------------------</a></li><li><a href="#29">%%</a></li><li><a href="#30">Addition number of frame</a></li><li><a href="#36">-------------------Treat spetial cases-----------------------</a></li><li><a href="#38">---------------- Calculate velocity -----------------</a></li><li><a href="#39">-------------------Calculate distance to antenna-------------------------------</a></li><li><a href="#40">------------------------Correct the coordinates-----------------------------------</a></li><li><a href="#41">---------------------------------Interpolate the coordinates-------------------------------</a></li><li><a href="#42">-----------------------------------Return repeated coordinates-------------------------------------------</a></li><li><a href="#43">-------------------------------------------------In Arena velocity with approximate real time -----------------------------</a></li><li><a href="#44">--------------------------------------EXCEPTIONS: The antenna position didn't correct the non-defined positions thus assign incorrect value------------</a></li><li><a href="#45">----------------------------Determine when it is stop,running, walking according to the velocity----------------------------</a></li><li><a href="#46">------------------------------------Determine if it is drinking or eating------------------------------------------</a></li><li><a href="#47">-----------------------------Determine if it is inside or outside a given zone----------------------------</a></li><li><a href="#48">-------------------------for further use create 2 auxiliary arrays----------------------</a></li><li><a href="#51">---------------------Save the locomotion parameters as a structure bring  all the mice together----------------------</a></li><li><a href="#52">--------------------Compute distance pairs---------------------------</a></li><li><a href="#53">-----------------------Compute together--------------------------------------</a></li><li><a href="#54">---------------------------Define object together--------------------------------</a></li><li><a href="#55">-------------------------------Calculating chasing-----------------------------</a></li><li><a href="#56">CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO GV MODULE</a></li><li><a href="#57">CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO SILVIA MODULE</a></li><li><a href="#59">CALCULATION OF AVOIDANCE(mouse2 near mouse1 but mouse1 running away from mouse2)</a></li><li><a href="#62">%%                                                  CALCULATION OF APPROACHING (mouse 1 approaches mouse 2 and the event finished)</a></li><li><a href="#64">%------------Save as a mat file---------------------------</a></li><li><a href="#65">-----------Change the format of the time as GV---------------------</a></li><li><a href="#70">%% ---------------------------------Arrange the chasing events into an excel file AGREGAR LO QUE FALTA----------------------------</a></li><li><a href="#71">--------------------SAVE SOCIAL EVENTS INTO EXCEL FILE-----------------</a></li><li><a href="#77">Create a wait bar for control</a></li><li><a href="#78">Clear the variables</a></li><li><a href="#81">--------Found in the RFID selected data the mouse with 2 identities--</a></li><li><a href="#82">---------------------------- Treat with the time-------------------------</a></li><li><a href="#83">In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena</a></li><li><a href="#85">----------Find is sleeping-------------------------</a></li><li><a href="#88">Addition number of frame</a></li><li><a href="#89">%% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena</a></li><li><a href="#91">------------------ Save to excel file---------------------------------</a></li><li><a href="#95">-------------------Treat spetial cases-----------------------</a></li><li><a href="#96">-------------------Add to the actual time line the missing position from the excel file fm----------</a></li><li><a href="#99">---------------- Calculate velocity -----------------</a></li><li><a href="#100">-------------------Calculate distance to antenna-------------------------------</a></li><li><a href="#101">------------------------Correct the coordinates-----------------------------------</a></li><li><a href="#103">--------Add correction to non defined correction in the case of having the excel file with positions------</a></li><li><a href="#104">%% --------Add correction to  duplicate position with different detection antenna in the case of having the excel file with positions------</a></li><li><a href="#107">---------------------------------Interpolate the coordinates-------------------------------</a></li><li><a href="#108">-----------------------------------Return repeated coordinates-------------------------------------------</a></li><li><a href="#109">-------------------------for further use create 2 auxiliary arrays----------------------</a></li><li><a href="#110">-------------------------------------------------In Arena velocity with approximate real time -----------------------------</a></li><li><a href="#111">----------------------------Determine when it is stop,running, walking according to the velocity----------------------------</a></li><li><a href="#112">------------------------------------Determine if it is drinking or eating------------------------------------------</a></li><li><a href="#113">-----------------------------Determine if it is inside or outside a given zone----------------------------</a></li><li><a href="#114">-------------------------for further use create 2 auxiliary arrays without repeats----------------------</a></li><li><a href="#117">---------------------Save the locomotion parameters as a structure bring  all the mice together----------------------</a></li><li><a href="#118">--------------------Compute distance pairs---------------------------</a></li><li><a href="#119">--------------------Compute if the mice are together----------------------------</a></li><li><a href="#120">---------------------------Define object together--------------------------------</a></li><li><a href="#122">-------------------------------Calculating chasing-----------------------------</a></li><li><a href="#130">%% Auxiliary functions</a></li><li><a href="#131">find  the last numbers</a></li><li><a href="#132">find RFID subset with the same date as the selected csv file</a></li><li><a href="#133">Find the time near to the RFID data for each frame</a></li><li><a href="#134">Arrange the coordinates in an horizontal way</a></li><li><a href="#135">To calculate distance between pair of mice-If one is in the arena/hiding or sleeping box  and vicevers  or both sleeping is NAN no information</a></li><li><a href="#137">----------Clear variables---------</a></li><li><a href="#142">-----------------------Function for saving Chasing, approachin/avoiding into an excel file------------------</a></li><li><a href="#144">%%   %% save into an excel file in a sheet called list of all chasing events</a></li><li><a href="#145">Sort the data according to the days</a></li><li><a href="#147">Save in another sheet data which appear as duplicate and it is not sure</a></li><li><a href="#148">Save in another sheet all the parameters</a></li><li><a href="#151">%%   %% save into an excel file in a sheet called list of all avoiding events</a></li><li><a href="#154">%%   %% save into an excel file in a sheet called list of all approaching events</a></li><li><a href="#156">-----------For removing duplicates from excel file------------------</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> ManagerComputeAll( ~,~ )
</pre><h2>------------------------------Variables---------------------------<a name="2"></a></h2><pre class="codeinput"><span class="keyword">global</span> h
clc
clear <span class="string">MouseArray</span>;
clear <span class="string">ArrayX</span>; <span class="comment">%for x coord.</span>
clear <span class="string">ArrayY</span>; <span class="comment">%for y coord.</span>
clear <span class="string">ArrayXY</span>;
ArrayX=[];
ArrayY=[];
ArrayXY=[];
</pre><h2>-----------------------Parameters----------------<a name="3"></a></h2><pre class="codeinput">Params=ParametersComputeAll;
</pre><pre class="codeoutput">
Params = 

    exp_name: 'Exp59L'


mice_3_chips = 

    '0007158da0''    '000715ddce''    '''
    '0007158e4a''    '000715e3d7''    '''
    '000715e4fb''    '0007157c2e''    '''
    '000715930b''    '000715c685''    '''
    '000715a0a0''    '00071590fc''    '''
    '''              '''              '''
    '''              '''              '''


Aux = 

    '0007158da0'


Aux1 =

x8da0


Aux = 

    '0007158e4a'


Aux1 =

x8e4a


Aux = 

    '000715e4fb'


Aux1 =

xe4fb


Aux = 

    '000715930b'


Aux1 =

x930b


Aux = 

    '000715a0a0'


Aux1 =

xa0a0


Params = 

         exp_name: 'Exp59L'
          DataDir: 'D:\Exp59\Data\Exp59LVideo'
       resultsDir: 'D:\Exp59\Data\Exp59LResultsMatlab'
      ForSomeFile: 0
       ChoiceList: 'Males'
    SaveDirectory: 'D:\Exp59\Data\Results'
            mices: 'all'
         miceType: [1x1 struct]
        malesList: {1x5 cell}
      femalesList: {1x0 cell}
     mice_3_chips: {7x3 cell}
    malesListRibs: {1x5 cell}

</pre><h2>----------------------------------Read Mat Files----------------<a name="4"></a></h2><h2>--------------------Read Parameters of csv files----------------<a name="5"></a></h2><pre class="codeinput">CSVobj=FilesTreat;<span class="comment">%use class FilesTreat</span>
CSVobj.directory=Params.DataDir;
CSVobj.extension=<span class="string">'.csv'</span>;
</pre><h2>----------------------------Select  your list if female or male----------------<a name="6"></a></h2><pre class="codeinput"><span class="keyword">switch</span> Params.ChoiceList
<span class="keyword">case</span> <span class="string">'Males'</span>
miceList=Params.malesList;
miceList=strrep(miceList,<span class="string">''''</span>,<span class="string">''</span>); <span class="comment">%for removing double quotes</span>
miceListRibs=Params.malesListRibs;
miceListRibs=strrep(miceListRibs,<span class="string">''''</span>,<span class="string">''</span>);
miceListRibsSecond=Params.malesListRibsSecond; <span class="comment">%in the case a third chip was implanted</span>

<span class="keyword">if</span> isempty(find(isnan([miceListRibsSecond{1:end}])==1))
miceListRibsSecond=strrep(miceListRibsSecond,<span class="string">''''</span>,<span class="string">''</span>);
<span class="keyword">end</span>

<span class="keyword">case</span> <span class="string">'Females'</span>
miceList=Params.femalesList;
miceList=strrep(miceList,<span class="string">''''</span>,<span class="string">''</span>); <span class="comment">%for removing double quotes</span>
miceListRibs=Params.femalesListRibs;
miceListRibs=strrep(miceListRibs,<span class="string">''''</span>,<span class="string">''</span>);
miceListRibsSecond=Params.femalesListRibsSecond;<span class="comment">%in the case a third chip was implanted</span>

<span class="keyword">if</span> isempty(find(isnan([miceListRibsSecond{1:end}])==1))
miceListRibsSecond=strrep(miceListRibsSecond,<span class="string">''''</span>,<span class="string">''</span>);
<span class="keyword">end</span>

<span class="keyword">end</span>
</pre><h2>--------------------Define object IsSleeping---------------------<a name="7"></a></h2><pre class="codeinput">IsSleepingobj=Sleeping; <span class="comment">%use class Sleeping</span>
IsSleepingobj.AntennaCage=Params.AntennaCage; <span class="comment">%number of antenna that detetect outside the arena</span>
IsSleepingobj.AntennaSideBox=Params.SideBoxAntenna;<span class="comment">%number of antenna in the side box</span>
IsSleepingobj.SleepingCoord=Params.Coordinates.CoordSleepingCells; <span class="comment">%coordinates of the sleeping cells if it is right or left</span>
</pre><h2>--------------------------Define object IsHiding-----------------<a name="8"></a></h2><pre class="codeinput">IsHidingobj=Hiding; <span class="comment">%use class Hiding</span>
IsHidingobj.AntennaHidingBox=Params.AntennaHidingBox;
IsHidingobj.HidingCoord=Params.Coordinates.HidingCoordinates; <span class="comment">%every 4rows is a different hiding box</span>
</pre><h2>-----------------------------Define object IsArena ---------------------------<a name="9"></a></h2><pre class="codeinput">InArenaobj=Arena;
InArenaobj. AntennaCoord=Params. AntennaCoord;<span class="comment">%antenna position</span>
InArenaobj.TreshWalk=Params.TreshWalk;<span class="comment">%walking threshold</span>
InArenaobj.TreshRun=Params.TreshRun;<span class="comment">%running threshold</span>
</pre><h2>---------------------------Define object Time---------------------------------<a name="10"></a></h2><pre class="codeinput">Timeobj=TimeLine;
</pre><h2>------------------------Define object IsEatingDrinking-----------------------------<a name="11"></a></h2><pre class="codeinput">IsEatingDrinkingobj=IsEatingDrinking;
IsEatingDrinkingobj.VelocityThreshFood=Params.VelocityThreshFood; <span class="comment">%velocity when is either eating or drinking</span>
IsEatingDrinkingobj.FoodCoordinates=Params.Coordinates.FoodCoordinates;<span class="comment">%coordinates of eating</span>
IsEatingDrinkingobj.WaterCoordinates=Params.Coordinates.WaterCoordinates;<span class="comment">%coordinates of drinking</span>
IsEatingDrinkingobj.radiusD=Params.radiusD; <span class="comment">%radius around drinking</span>
</pre><pre class="codeinput"><span class="comment">%%-----------Define object IsInZone----------------</span>
IsInZoneobj=IsInZone;
IsInZoneobj.ZoneCoord=Params.ZoneCoord;
</pre><pre class="codeinput"><span class="comment">%%-------SELECT BETWEEN DOING ALL THE EXPERIMENT OR THE SELECTION OF SOME</span>
<span class="comment">%%FILES---</span>

<span class="keyword">switch</span> Params.ForSomeFile
<span class="keyword">case</span> 0 <span class="comment">%All the experiment</span>
</pre><pre class="codeinput">nCSV=CSVobj.NumFiles(CSVobj.ListFiles);  <span class="comment">%number of files of all the experiment</span>

<span class="keyword">for</span> i=1:nCSV <span class="comment">%loop over the original files</span>
</pre><h2>Variables<a name="16"></a></h2><pre class="codeinput">clear <span class="string">ArrayX</span>; <span class="comment">%for x coord.</span>
clear <span class="string">ArrayY</span>; <span class="comment">%for y coord.</span>
clear <span class="string">ArrayXY</span>;
ArrayX=[];
ArrayY=[];
ArrayXY=[];
clear <span class="string">Distance</span>;
clear  <span class="string">VectorX</span>;
clear  <span class="string">VectorY</span>;
clear  <span class="string">VectorX1</span>;
clear  <span class="string">VectorY1</span>;
Distance=[];
VectorX=[];
VectorY=[];
VectorX1=[];
VectorY1=[];
clear <span class="string">MouseArray</span>;
</pre><h2>Read excel and matlab files for each nCSV<a name="17"></a></h2><pre class="codeinput">CSVFile=CSVobj.ReadFilesAllCSV(CSVobj.ListFiles,i);<span class="comment">%read each file</span>
CSVmiceIDs=CSVobj.miceIDs(CSVobj.ListFiles,i);<span class="comment">%read the mice identities of each file-Now the  order of the mice identity is the same for each file</span>
CSVFileName=CSVobj.FileName(CSVobj.ListFiles,i);

<span class="comment">% Read the mat file</span>


MatFileName=strcat(CSVFileName(1:strfind(CSVFileName,<span class="string">']'</span>)),<span class="string">'.mat'</span>);

load(MatFileName); <span class="comment">%the structure is lococomotion</span>
</pre><pre class="codeoutput">
ListFiles = 

126x1 struct array with fields:

    name
    date
    bytes
    isdir
    datenum


ListFiles = 

126x1 struct array with fields:

    name
    date
    bytes
    isdir
    datenum


ListFiles = 

126x1 struct array with fields:

    name
    date
    bytes
    isdir
    datenum

</pre><pre class="codeinput"> hn=msgbox(strcat(<span class="string">'Doing File:'</span>,num2str(i)))

<span class="comment">% %% %%-------- According to date select RFDI----------------</span>
<span class="comment">% ListFiles=CSVobj.ListFiles;</span>
<span class="comment">% ListFiles(i).name</span>
<span class="comment">%  IndexFilesDates=findRFIDSubset(ListFiles(i).name,DateFiles);</span>
<span class="comment">%</span>
<span class="comment">%  SelectedDataRFID=RFIDobj.ReadFilesAllDate(RFIDobj.ListFiles,IndexFilesDates);</span>
</pre><pre class="codeoutput">
hn = 

  Figure (Msgbox_ ) with properties:

      Number: []
        Name: ' '
       Color: [0.9400 0.9400 0.9400]
    Position: [657.5000 505.1667 125 52.2500]
       Units: 'points'

  Use GET to show all properties

</pre><img vspace="5" hspace="5" src="ManagerComputeAll_01.png" alt=""> <h2>Create a wait bar for control<a name="19"></a></h2><pre class="codeinput">hbar = waitbar(0,<span class="string">'Please wait...'</span>);

<span class="comment">% Rearrange the data according to the mice in a multidimensional array</span>

<span class="keyword">for</span> j=1:length(miceList) <span class="comment">%for each mouse</span>
</pre><h2>Clear the variables<a name="20"></a></h2><pre class="codeinput">    clear <span class="string">AuxID</span>
    clear <span class="string">Auxtime</span>
    clear <span class="string">Auxantenna</span>
    clear <span class="string">Iaux</span>
    clear <span class="string">AuxIDn</span>
    clear <span class="string">Auxtimen</span>
    clear <span class="string">Auxantennan</span>
</pre><pre class="codeinput"><span class="comment">%ONLY CONSIDER THE LAST NUMBERS SINCE SOMETIMES THE INITIAL ZERO DISSAPEAR</span>

Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,<span class="string">'UniformOutput'</span>, false);

MouseArray(2:length([CSVFile{1}])+1,1,j)=CSVFile{1}; <span class="comment">%for date</span>
MouseArray(2:length([CSVFile{2}])+1,2,j)=strcat(<span class="string">''''</span>,[CSVFile{2}],<span class="string">''''</span>); <span class="comment">%for time</span>

<span class="keyword">if</span> ~isempty(find(cell2mat(Ind)==1))
</pre><pre class="codeinput">MouseArray(2:length([CSVFile{2}])+1,3,j)=num2cell(CSVFile{3+(find(cell2mat(Ind)==1)-1)*3}); <span class="comment">%for x</span>
MouseArray(2:length([CSVFile{2}])+1,4,j)=num2cell(CSVFile{4+(find(cell2mat(Ind)==1)-1)*3}); <span class="comment">%for y</span>
</pre><h2>--------Found in the RFID selected data the mouse with 2 identities head or reabs--<a name="23"></a></h2><pre class="codeinput"><span class="comment">%%----------Couple RFID with original time----------------------------------</span>


AuxID=vertcat(SelectedDataRFID{:,1});<span class="comment">%identity</span>
Auxtime=vertcat(SelectedDataRFID{:,3}); <span class="comment">%time</span>
Auxantenna=vertcat(SelectedDataRFID{:,4}); <span class="comment">%antenna</span>

<span class="keyword">if</span> ~isempty(find(isnan([miceListRibsSecond{1:end}])==1))<span class="comment">%for 2 chips</span>
Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1)]; <span class="comment">%find the identity of the respective mouse either with the ribs or head ID</span>

<span class="keyword">else</span> <span class="comment">%for 3 chips</span>
 Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1);find(strcmp(miceListRibsSecond(j),AuxID)==1)]; <span class="comment">%find the identity of the respective mouse either with the chips on the ribs int 2 places or head ID</span>

<span class="keyword">end</span>


<span class="comment">%for the specific mouse</span>
 AuxIDn=AuxID(Iaux);
 Auxtimen=Auxtime(Iaux);
 Auxantennan=Auxantenna(Iaux);

  <span class="comment">%search the similar time points for each frame in the csv file</span>
  d=knnsearch(datenum(Auxtimen,<span class="string">'HH:MM:SS.FFF'</span>),datenum(CSVFile{2},<span class="string">'HH:MM:SS.FFF'</span>));


   <span class="comment">%save rfid data in a mouse array</span>
    MouseArray(2:length([CSVFile{2}])+1,5,j)=strcat(<span class="string">''''</span>,Auxtimen(d),<span class="string">''''</span>); <span class="comment">%RFID time</span>
    MouseArray(2:length([CSVFile{2}])+1,6,j)=Auxantennan(d); <span class="comment">%antenna rfid</span>
</pre><h2>---------------------------- Treat with the time-------------------------<a name="24"></a></h2><pre class="codeinput">    Timeobj.FrameTime=[CSVFile{2}];
    Timeobj.RFIDTime=Auxtimen(d);

    DeltaTimeFrameRFID=abs(Timeobj.DeltaTime)*1000 ;<span class="comment">%for getting in ms-- difference between rfid and the frame time</span>
    MouseArray(2:length([CSVFile{2}])+1,22,j)=num2cell(DeltaTimeFrameRFID);

    <span class="comment">%----------------define time object for sleeping----------------------</span>
    IsSleepingobj.TimeLapseFrameAntenna=DeltaTimeFrameRFID;

    <span class="comment">%------do frame time difference----------------</span>
    FrameTimeDif=abs(Timeobj.FrameTimeDif)*1000; <span class="comment">%for getting in ms-difference with the same frame</span>
     MouseArray(2:length([CSVFile{2}])+1,23,j)=num2cell(FrameTimeDif);
</pre><h2>In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena<a name="25"></a></h2><pre class="codeinput">      <span class="keyword">if</span> i==1
        I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(1,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(1:I-1,6,j)={<span class="string">''</span>};
        <span class="keyword">end</span>

    <span class="keyword">end</span>
</pre><pre class="codeinput">  MouseArray(2:length([CSVFile{2}])+1,7,j)=AuxIDn(d); <span class="comment">%mouse id</span>
</pre><h2>%% ----------Find is sleeping-------------------------<a name="27"></a></h2><pre class="codeinput">      IsSleepingobj.CoordinateX=MouseArray(:,3,j);
      IsSleepingobj.CoordinateY=MouseArray(:,4,j);
      IsSleepingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,8,j)=num2cell(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping));

     SleepingInterval=IsSleepingobj.IsSleepingInterval(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping)); <span class="comment">%sleeping interval</span>
     SleepingBeg= SleepingInterval(:,1);
     SleepingEnd=SleepingInterval(:,2);
     MouseArray(2:length(SleepingBeg)+1,17,j)=num2cell(SleepingBeg);
     MouseArray(2:length(SleepingEnd)+1,18,j)=num2cell(SleepingEnd);


     <span class="comment">%find the number of the sleeping cage</span>
     MouseArray(2:length([CSVFile{2}])+1,9,j)=num2cell(IsSleepingobj.IsSleepingCage(SleepingInterval));

     <span class="comment">%arrange coordinates for sleeping</span>
     MouseArray(2:length([CSVFile{2}])+1,13:14,j)=num2cell(IsSleepingobj.IsSleepingCoord(SleepingInterval,IsSleepingobj.IsSleepingCage(SleepingInterval)));
</pre><pre class="codeinput">       <span class="comment">%%-------------------------------- Find is hiding----------------------------------------</span>
      IsHidingobj.CoordinateX=MouseArray(:,13,j);<span class="comment">%use the coordinates after the correction of sleeping</span>
      IsHidingobj.CoordinateY=MouseArray(:,14,j);
      IsHidingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,10,j)=num2cell(IsHidingobj.IsHiding);

       <span class="comment">%find hiding interval</span>

     HidingInterval=IsHidingobj.IsHidingInterval(IsHidingobj.IsHiding); <span class="comment">%sleeping interval</span>
     HidingBeg= HidingInterval(:,1);
     HidingEnd=HidingInterval(:,2);
     MouseArray(2:length(HidingBeg)+1,19,j)=num2cell(HidingBeg);
     MouseArray(2:length(HidingEnd)+1,20,j)=num2cell(HidingEnd);

     <span class="comment">%find the number of the hiding box</span>
     MouseArray(2:length([CSVFile{2}])+1,11,j)=num2cell(IsHidingobj.IsHidingCage(HidingInterval));

      <span class="comment">%arrange coordinates for hiding</span>
     MouseArray(2:length([CSVFile{2}])+1,15:16,j)=num2cell(IsHidingobj.IsHidingCoord(HidingInterval,IsHidingobj.IsHidingCage(HidingInterval)));
</pre><h2>%%<a name="29"></a></h2><pre class="codeinput">     <span class="comment">%-----------------------------Find is in the arena-------------------------------------</span>
    <span class="comment">%find the interval for in arena</span>
     InArenaobj.IsSleeping=MouseArray(:,8,j);
     InArenaobj.IsHiding=MouseArray(:,10,j);
     InArenaobj.AntennaNumber=Auxantennan(d);

     MouseArray(2:length([CSVFile{2}])+1,12,j)=num2cell(InArenaobj.InArena);
</pre><h2>Addition number of frame<a name="30"></a></h2><pre class="codeinput">     MouseArray(2:length([CSVFile{2}])+1,21,j)=num2cell([0:length([CSVFile{2}])-1]');
</pre><pre class="codeinput">    <span class="keyword">if</span> i==1 <span class="comment">%for the first csv file</span>
        I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(2,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(2:length([CSVFile{2}])+1,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(2:I-1,12,j)=num2cell(0);
        <span class="keyword">end</span>

    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">else</span> <span class="comment">%if the mouse doesn't exit</span>
<span class="comment">%   MouseArray(:,3,j)={''};</span>
 MouseArray(2:length([CSVFile{2}])+1,3:21,j)=num2cell([0]);
<span class="keyword">end</span>
<span class="comment">%</span>
<span class="comment">%</span>
</pre><pre class="codeinput"><span class="comment">%%Coordinates after sleeping and hiding</span>

   ArrayX=[ArrayX,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15,j))];
   ArrayY=[ArrayY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,16,j))];
   ArrayXY=[ArrayXY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15:16,j))];
</pre><pre class="codeinput"> <span class="comment">%Control of wait bar</span>
 waitbar(j/length(miceList));
</pre><pre class="codeinput"><span class="keyword">end</span>
<span class="comment">%NOTE:DECIDE IF TO SAVE THE MOUSE ARRAY MATRIX</span>

<span class="comment">% Results.miceList=miceList;</span>
<span class="comment">% Results.MouseArray=MouseArray;</span>
<span class="comment">%  %save(mat according the date)</span>
 close(hbar)
</pre><h2>-------------------Treat spetial cases-----------------------<a name="36"></a></h2><pre class="codeinput"><span class="comment">%---------------Find repeated Frames for further use-------------------</span>
  RepeatedFrames=CSVobj.RemoveDuplicFrame(ArrayXY);

 <span class="comment">%----------------Identified in the arena duplicates and no video ---</span>

hbar=waitbar(0,<span class="string">'Second part wait'</span>)

<span class="keyword">for</span> j=1:length(miceList)
    clear <span class="string">InArenaNonDefined</span>;
    clear <span class="string">InArenaDuplicates</span>;
   Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,<span class="string">'UniformOutput'</span>, false);

    <span class="keyword">if</span> ~isempty(find(cell2mat(Ind)==1))
</pre><pre class="codeinput">      <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
         InArenaNonDefined=InArenaobj.InArenaNonDefined(ArrayX,ArrayY,j,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
         InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length(miceList),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
         MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(InArenaDuplicates);
         MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);
      <span class="keyword">else</span>
          MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(0);<span class="comment">%for cases it is inside the cage all along the file</span>
          MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(0);
      <span class="keyword">end</span>
</pre><h2>---------------- Calculate velocity -----------------<a name="38"></a></h2><pre class="codeinput">   <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
       InArenaVelocity=InArenaobj.InArenaVelocity(RepeatedFrames,ArrayX(:,j),ArrayY(:,j), (cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j))));
       MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(InArenaVelocity);
   <span class="keyword">else</span>
      MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(0); <span class="comment">%for cases it is inside the cage all along the file</span>
   <span class="keyword">end</span>
</pre><h2>-------------------Calculate distance to antenna-------------------------------<a name="39"></a></h2><pre class="codeinput">    <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
     InArenaAntennaDistance=InArenaobj.InArenaAntennaDistance(ArrayX(:,j),ArrayY(:,j),InArenaDuplicates,MouseArray(2:length([CSVFile{2}])+1,6,j));
     MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell( InArenaAntennaDistance);
    <span class="keyword">else</span>
     MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell(0); <span class="comment">%for cases it is inside the cage all along the file</span>
    <span class="keyword">end</span>
</pre><h2>------------------------Correct the coordinates-----------------------------------<a name="40"></a></h2><pre class="codeinput">   <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
        InArenaCorrectedCoord=InArenaobj.InArenaCorrectedCoord(ArrayX(:,j),ArrayY(:,j),RepeatedFrames, InArenaAntennaDistance,InArenaDuplicates,InArenaNonDefined,cell2mat(MouseArray(2:length([CSVFile{2}])+1,22,j)),MouseArray(2:length([CSVFile{2}])+1,6,j));
        MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedCoord(:,1));
        MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedCoord(:,2));
   <span class="keyword">else</span>
        MouseArray(2:length([CSVFile{2}])+1,28,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
        MouseArray(2:length([CSVFile{2}])+1,29,j)=MouseArray(2:length([CSVFile{2}])+1,16,j);<span class="comment">%for cases it is inside the cage all along the file</span>
   <span class="keyword">end</span>
</pre><h2>---------------------------------Interpolate the coordinates-------------------------------<a name="41"></a></h2><pre class="codeinput">        TimeFrame=cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j));
        <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
            <span class="keyword">try</span> <span class="comment">%in the case the interpolation is not working  giving error returned old coordinates</span>
             InArenaInterpolation=InArenaobj.InArenaInterpolation(RepeatedFrames,TimeFrame,InArenaCorrectedCoord(:,1),InArenaCorrectedCoord(:,2));

           MouseArray(2:length([CSVFile{2}])+1,30,j)=num2cell(InArenaInterpolation(:,1));
           MouseArray(2:length([CSVFile{2}])+1,31,j)=num2cell(InArenaInterpolation(:,2));

            <span class="keyword">catch</span>
               MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
              MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j);

            <span class="keyword">end</span>

        <span class="keyword">else</span>
            MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
            MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); <span class="comment">%for cases it is inside the cage all along the file</span>

        <span class="keyword">end</span>
</pre><h2>-----------------------------------Return repeated coordinates-------------------------------------------<a name="42"></a></h2><pre class="codeinput">        <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) <span class="comment">%verify that part of the time is in the arena - there csv files where the mouse was all time in the cage</span>
             InArenaAddRepeats=InArenaobj.InArenaAddRepeats(RepeatedFrames,InArenaInterpolation(:,1),InArenaInterpolation(:,2));
             MouseArray(2:length([CSVFile{2}])+1,32,j)=num2cell(InArenaAddRepeats(:,1));
             MouseArray(2:length([CSVFile{2}])+1,33,j)=num2cell(InArenaAddRepeats(:,2));
        <span class="keyword">else</span>
             MouseArray(2:length([CSVFile{2}])+1,32,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
             MouseArray(2:length([CSVFile{2}])+1,33,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); <span class="comment">%for cases it is inside the cage all along the file</span>
        <span class="keyword">end</span>

        <span class="comment">% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena</span>
      <span class="keyword">if</span> i==1
        I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(1,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(1:I-1,32,j)={<span class="string">''</span>};
        MouseArray(1:I-1,33,j)={<span class="string">''</span>};
        <span class="keyword">end</span>

    <span class="keyword">end</span>
</pre><h2>-------------------------------------------------In Arena velocity with approximate real time -----------------------------<a name="43"></a></h2><pre class="codeinput">    RealTime=78; <span class="comment">%Real time is 78ms</span>
    <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
         InArenaVelocityR=InArenaobj.InArenaVelocityR(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2),RealTime,cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j)));
         MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(InArenaVelocityR);
    <span class="keyword">else</span>
        MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(0);<span class="comment">%for cases it is inside the cage all along the file</span>
    <span class="keyword">end</span>
</pre><h2>--------------------------------------EXCEPTIONS: The antenna position didn't correct the non-defined positions thus assign incorrect value------------<a name="44"></a></h2><pre class="codeinput">    clear <span class="string">Iexception1</span>
    clear <span class="string">Iexception2</span>

    <span class="comment">%Consider the cases which are in the arena , not defined (1e6 coord</span>
    <span class="comment">%value) and negative or very big coordinates either x or y.Then in</span>
    <span class="comment">%arena is zero (we cannot say nothing</span>
    Iexception1=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)))&gt;2000 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    Iexception2=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)))&gt;2000 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);

    <span class="keyword">if</span> ~isempty(find(Iexception1==1))
        MouseArray(Iexception1,12,j)=num2cell([0]);
    <span class="keyword">elseif</span> ~isempty(find(Iexception2==1))
        MouseArray(Iexception2,12,j)=num2cell([0]);

    <span class="keyword">end</span>


    <span class="comment">%-----------------------------------</span>
</pre><h2>----------------------------Determine when it is stop,running, walking according to the velocity----------------------------<a name="45"></a></h2><pre class="codeinput">     InArenaVelocityRInterp=InArenaobj.InArenaVelocityRInterp(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));

<span class="comment">%      InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));</span>
    <span class="comment">%InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)));</span>

   InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,InArenaVelocityRInterp,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));

    MouseArray(2:length([CSVFile{2}])+1,35,j)=num2cell(InArenaVelocityRInterp(:,1));<span class="comment">%add to velocity interpolation where the velocity is zero</span>
    MouseArray(2:length([CSVFile{2}])+1,36,j)=num2cell(InArenaActivity(:,1)); <span class="comment">%stop</span>
    MouseArray(2:length([CSVFile{2}])+1,37,j)=num2cell(InArenaActivity(:,2));<span class="comment">%walking</span>
    MouseArray(2:length([CSVFile{2}])+1,38,j)=num2cell(InArenaActivity(:,3));<span class="comment">%running</span>



   <span class="comment">%---------------------------------------------------------------------------------------------</span>
</pre><h2>------------------------------------Determine if it is drinking or eating------------------------------------------<a name="46"></a></h2><pre class="codeinput">   <span class="comment">%First complete in all the repeated frames the velocities</span>
   clear <span class="string">InArenaVelocityAllFrames</span>;


   InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,InArenaVelocityRInterp);

     IsEating=IsEatingDrinkingobj. IsEating(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);
     IsDrinking=IsEatingDrinkingobj. IsDrinking(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);

    MouseArray(2:length([CSVFile{2}])+1,39,j)=num2cell(IsEating);<span class="comment">%eating</span>
    MouseArray(2:length([CSVFile{2}])+1,40,j)=num2cell(IsDrinking);<span class="comment">%drinking</span>
</pre><h2>-----------------------------Determine if it is inside or outside a given zone----------------------------<a name="47"></a></h2><pre class="codeinput">    IsZone=IsInZoneobj.IsZone(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)));

    MouseArray(2:length([CSVFile{2}])+1,41,j)=num2cell(IsZone(:,1));<span class="comment">%inner zone</span>
    MouseArray(2:length([CSVFile{2}])+1,42,j)=num2cell(IsZone(:,2));<span class="comment">%outside zone</span>
</pre><h2>-------------------------for further use create 2 auxiliary arrays----------------------<a name="48"></a></h2><pre class="codeinput">   <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
       InArenaAuxiliary=InArenaobj.InArenaAuxiliary(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2));
       Distance(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,1);
       VectorX(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,2); <span class="comment">%normalized vector</span>
       VectorY(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,3); <span class="comment">%normalized vector</span>

       VectorX1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,4); <span class="comment">%not normalized vector</span>
       VectorY1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,5); <span class="comment">%not normalized vector</span>
    <span class="keyword">else</span>
           Distance(1:length(RepeatedFrames)-1,j)=0; <span class="comment">%in the case it is inside all the time</span>
           VectorX(1:length(RepeatedFrames)-1,j)=0;
           VectorY(1:length(RepeatedFrames)-1,j)=0;
          VectorX1(1:length(RepeatedFrames)-1,j)=0;
           VectorY1(1:length(RepeatedFrames)-1,j)=0;
    <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">else</span> <span class="comment">%if the mouse doesn't exit</span>
 MouseArray(2:length([CSVFile{2}])+1,3:42,j)=num2cell([0]);

<span class="keyword">end</span>
<span class="comment">%</span>

     waitbar(j/length(miceList));

<span class="keyword">end</span>
 close(hbar)
</pre><pre class="codeoutput">
hbar = 

  Figure (TMWWaitbar) with properties:

      Number: []
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [585 376.5000 270 56.2500]
       Units: 'points'

  Use GET to show all properties

</pre><h2>---------------------Save the locomotion parameters as a structure bring  all the mice together----------------------<a name="51"></a></h2><pre class="codeinput">Locomotion.miceList=miceList;
Large=length(MouseArray(:,12,1));
Locomotion.isInArena=reshape(cell2mat(MouseArray(2:Large,12,:)),Large-1,length(miceList));
Locomotion.TrajectoryX=reshape(cell2mat(MouseArray(2:Large,32,:)),Large-1,length(miceList)); <span class="comment">%coord after corrections with repeats</span>
Locomotion.TrajectoryY=reshape(cell2mat(MouseArray(2:Large,33,:)),Large-1,length(miceList));  <span class="comment">%coord after corrections with repeats</span>
<span class="comment">% Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,34,:)),Large-1,length(miceList)); %velocity of the real frames</span>
Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,35,:)),Large-1,length(miceList)); <span class="comment">%velocity of the real frames by including interpolation of zero velocity points inside the arena</span>
Locomotion.InArenaDuplicates=reshape(cell2mat(MouseArray(2:Large,24,:)),Large-1,length(miceList)); <span class="comment">%In arena duplicates</span>
Locomotion.RepeatedFrames=RepeatedFrames;
Locomotion.ExperimentalTime=MouseArray(2:Large,2,1); <span class="comment">%take only one mouse since it is the same time for everything.</span>
Locomotion.VectorX=VectorX; <span class="comment">%without repeats</span>
Locomotion.VectorY=VectorY; <span class="comment">%without repeats</span>
Locomotion.Distance=Distance;<span class="comment">%without repeats</span>
Locomotion.VectorX1=VectorX1; <span class="comment">%without repeats no normalized</span>
Locomotion.VectorY1=VectorY1; <span class="comment">%no normalized</span>
Locomotion.isStop=reshape(cell2mat(MouseArray(2:Large,36,:)),Large-1,length(miceList));
Locomotion.isWalking=reshape(cell2mat(MouseArray(2:Large,37,:)),Large-1,length(miceList));
Locomotion.isRunning=reshape(cell2mat(MouseArray(2:Large,38,:)),Large-1,length(miceList));
Locomotion.IsEating=reshape(cell2mat(MouseArray(2:Large,39,:)),Large-1,length(miceList));
Locomotion.IsDrinking=reshape(cell2mat(MouseArray(2:Large,40,:)),Large-1,length(miceList));
Locomotion.IsSleeping=reshape(cell2mat(MouseArray(2:Large,8,:)),Large-1,length(miceList));
Locomotion.IsHiding=reshape(cell2mat(MouseArray(2:Large,10,:)),Large-1,length(miceList));
Locomotion.SleepingBox=reshape(cell2mat(MouseArray(2:Large,9,:)),Large-1,length(miceList));
Locomotion.HidingBox=reshape(cell2mat(MouseArray(2:Large,11,:)),Large-1,length(miceList));
Locomotion.IsInsideZone=reshape(cell2mat(MouseArray(2:Large,41,:)),Large-1,length(miceList));
Locomotion.IsOutsideZone=reshape(cell2mat(MouseArray(2:Large,42,:)),Large-1,length(miceList));
</pre><h2>--------------------Compute distance pairs---------------------------<a name="52"></a></h2><pre class="codeinput"> DistancePairs=computeDistancePairsGV(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.IsHiding,Locomotion.RepeatedFrames);
Locomotion.DistancePairs=DistancePairs;
</pre><h2>-----------------------Compute together--------------------------------------<a name="53"></a></h2><h2>---------------------------Define object together--------------------------------<a name="54"></a></h2><pre class="codeinput">Togetherobj=Together;
Togetherobj.DistanceToBeTogether=Params.DistanceToBeTogheter; <span class="comment">%distance to be considered together in general is 10cm</span>
Togetherobj.numOfMice=length(Locomotion.miceList);

TogetherCalc=Togetherobj.TogetherCalc(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.RepeatedFrames);
Locomotion.TimesTogether=TogetherCalc(1,length(Locomotion.miceList)+1);
Locomotion.TogetherAll=TogetherCalc(1,1:length(Locomotion.miceList));
</pre><pre class="codeoutput">
hbar = 

  Figure (TMWWaitbar) with properties:

      Number: []
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [585 376.5000 270 56.2500]
       Units: 'points'

  Use GET to show all properties

</pre><h2>-------------------------------Calculating chasing-----------------------------<a name="55"></a></h2><pre class="codeinput"><span class="comment">%---------Create chasing object-------------------</span>
<span class="comment">%All the units are in mm</span>
Chasingobj=Chasing;
Chasingobj.numOfMice=length(Locomotion.miceList);
Chasingobj.Dist_tresh1=300;
Chasingobj.Velocity_Tresh=0.5;
Chasingobj.PathTresh=600;
Chasingobj.Dist_tresh2=200;
<span class="comment">%</span>
Chasingobj.AngleMaximum1=Params.AngleMaximum1; <span class="comment">%This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.</span>
Chasingobj.AngleMaximum2=Params.AngleMaximum2; <span class="comment">%This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.</span>
Chasingobj.MinimumPath=Params.editpar1; <span class="comment">%This is the minimum path recording to be considered as chasing.</span>
Chasingobj.GapPath=Params.editpar2; <span class="comment">%This is the maximum distance allow to finish the chasing mm</span>
Chasingobj.ThreshVelocity=Params.editpar3; <span class="comment">%20-10 cm/sec</span>
Chasingobj.GapFrames=Params.editpar4; <span class="comment">%maximum number of frames to be allowed to be a gap</span>
Chasingobj.GapPathEnd=Params.editpar5; <span class="comment">%the end of the frame</span>

Chasingobj.GapFramesS=Params.editpar6; <span class="comment">%maximum number of frames to be allowed to be a gap in small frames</span>
Chasingobj.GapPathEndS=Params.editpar7; <span class="comment">% condition of the end of the frame in small frames</span>

<span class="comment">% Chasingobj.AngleMaximum1=20; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.</span>
<span class="comment">% Chasingobj.AngleMaximum2=20; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.</span>
<span class="comment">% Chasingobj.MinimumPath=200; %This is the minimum path recording to be considered as chasing.</span>
<span class="comment">% Chasingobj.GapPath=400; %This is the maximum distance allow to finish the chasing mm</span>
<span class="comment">% Chasingobj.ThreshVelocity=10; %20-10 cm/sec</span>
<span class="comment">% Chasingobj.GapFrames=100; %maximum number of frames to be allowed to be a gap</span>
<span class="comment">% Chasingobj.GapPathEnd=200; %the end of the frame</span>






<span class="comment">%-------------------------</span>

TrajectoryX=Locomotion.TrajectoryX(Locomotion.RepeatedFrames,:);
TrajectoryY=Locomotion.TrajectoryY(Locomotion.RepeatedFrames,:);
Velocity=Locomotion.Velocity(Locomotion.RepeatedFrames,:);
</pre><h2>CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO GV MODULE<a name="56"></a></h2><pre class="codeinput"><span class="comment">% ChasingCal=Chasingobj.ChasingCal(TrajectoryX,TrajectoryY,Locomotion.Velocity(Locomotion.RepeatedFrames,:),Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.VectorX,Locomotion.VectorY,Locomotion.Distance,Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:));</span>
</pre><h2>CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO SILVIA MODULE<a name="57"></a></h2><pre class="codeinput"> ChasingCalvs2=Chasingobj.ChasingCalvs2(TrajectoryX,TrajectoryY,Locomotion.VectorX1,Locomotion.VectorY1,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Velocity,Locomotion.InArenaDuplicates(Locomotion.RepeatedFrames,:) );
</pre><pre class="codeoutput">
hbar = 

  Figure (TMWWaitbar) with properties:

      Number: []
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [585 376.5000 270 56.2500]
       Units: 'points'

  Use GET to show all properties

</pre><pre class="codeinput"><span class="comment">% Locomotion.ChasingAll=ChasingCal(:,1:Chasingobj.numOfMice);</span>
<span class="comment">% Locomotion.ChasedAll=ChasingCal(:,Chasingobj.numOfMice+1:2*Chasingobj.numOfMice);</span>

<span class="comment">% Locomotion.MoveTogether=ChasingCal(:,2*Chasingobj.numOfMice+1:3*Chasingobj.numOfMice);</span>


Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);
Locomotion.BeingChasingAll=ChasingCalvs2(:,Chasingobj.numOfMice+1:Chasingobj.numOfMice+Chasingobj.numOfMice);
Locomotion.TimeWithoutRepeats=Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:);



hhh=msgbox(<span class="string">'Chasing analysis finish'</span>)
close(hhh)
</pre><pre class="codeoutput">
hhh = 

  Figure (Msgbox_ ) with properties:

      Number: []
        Name: ' '
       Color: [0.9400 0.9400 0.9400]
    Position: [657.5000 505.1667 125 52.2500]
       Units: 'points'

  Use GET to show all properties

</pre><h2>CALCULATION OF AVOIDANCE(mouse2 near mouse1 but mouse1 running away from mouse2)<a name="59"></a></h2><pre class="codeinput"><span class="comment">% Create Avoidance object</span>
Avoidanceobj=Avoidance;
Avoidanceobj.numOfMice=length(Locomotion.miceList);
Avoidanceobj.Distance_thresh= Params.Distance_thresh_For_Avoidance;
Avoidanceobj.Dist_thresh_Fine_Tuning=Params.Dist_thresh_Fine_Tuning_For_Avoidance; <span class="comment">%dist for fine tuning according GV is 100mm</span>
Avoidanceobj.velThr=Params.Velocity_For_Avoidance;<span class="comment">% according gv 35cm/sec</span>
Avoidanceobj.R=Params.Radius_Within_Avoidance;<span class="comment">% according gv 30 cm</span>
</pre><pre class="codeinput">AvoidanceCal=Avoidanceobj.AvoidanceCal(TrajectoryX,TrajectoryY,Velocity,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames)
</pre><pre class="codeoutput">
hbar = 

  Figure (TMWWaitbar) with properties:

      Number: []
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [585 376.5000 270 56.2500]
       Units: 'points'

  Use GET to show all properties


AvoidanceCal = 

    []    []    []    []    []

</pre><pre class="codeinput">Locomotion.avoiding=AvoidanceCal;

hhhh=msgbox(<span class="string">'Avoidance calculation was finished'</span>)
close(hhhh)
</pre><pre class="codeoutput">
hhhh = 

  Figure (Msgbox_ ) with properties:

      Number: []
        Name: ' '
       Color: [0.9400 0.9400 0.9400]
    Position: [647 505.1667 146 52.2500]
       Units: 'points'

  Use GET to show all properties

</pre><h2>%%                                                  CALCULATION OF APPROACHING (mouse 1 approaches mouse 2 and the event finished)<a name="62"></a></h2><pre class="codeinput"><span class="comment">% Create Approaching object</span>
 Approachingobj=Approaching;
 Approachingobj.numOfMice=length(Locomotion.miceList);
 Approachingobj.Distance_thresh= Params.Distance_thresh_For_Approaching; <span class="comment">%According to GV this is 40cm</span>
 Approachingobj.distTr=Params.Distance_Thresh_For_Approaching_Fine_Tuning;<span class="comment">%According to GV this is 10cm</span>
 Approachingobj.CorrelFactor=Params.CorrFactor_between_mice_For_Approaching; <span class="comment">%According to GV this is 0.3</span>
 Approachingobj.velTr2=Params.Velocity_Thresh_To_beSamePlace_For_Approaching; <span class="comment">%According to GV this is 25cm/sec</span>
</pre><pre class="codeinput">ApproachingCal=Approachingobj.ApproachingCal(TrajectoryX,TrajectoryY,Velocity,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Locomotion.VectorX,Locomotion.VectorY)
<span class="comment">% %%</span>
Locomotion.ApproachingAll=ApproachingCal(:,1:Approachingobj.numOfMice);
Locomotion.BeingApproachingAll=ApproachingCal(:,Approachingobj.numOfMice+1:Approachingobj.numOfMice+Approachingobj.numOfMice);

hhhh=msgbox(<span class="string">'Approaching calculation was finished'</span>)
close(hhhh)
</pre><pre class="codeoutput">
hbar = 

  Figure (TMWWaitbar) with properties:

      Number: []
        Name: ''
       Color: [0.9400 0.9400 0.9400]
    Position: [585 376.5000 270 56.2500]
       Units: 'points'

  Use GET to show all properties


ApproachingCal = 

    []    []    []    []    []    []    []    []    []    []


hhhh = 

  Figure (Msgbox_ ) with properties:

      Number: []
        Name: ' '
       Color: [0.9400 0.9400 0.9400]
    Position: [643.2500 505.1667 153.5000 52.2500]
       Units: 'points'

  Use GET to show all properties

</pre><h2>%------------Save as a mat file---------------------------<a name="64"></a></h2><pre class="codeinput">Namef=char(ListFiles(i).name);
filename1=strcat(Namef(1:end-4),<span class="string">'.mat'</span>);
</pre><pre class="codeoutput error">Undefined variable "ListFiles" or class "ListFiles".

Error in ManagerComputeAll (line 648)
Namef=char(ListFiles(i).name);
</pre><h2>-----------Change the format of the time as GV---------------------<a name="65"></a></h2><pre class="codeinput">Indexes=strfind(filename1,<span class="string">'-'</span>); <span class="comment">%the first one gives the date</span>

date1=strrep(filename1(1:Indexes(1)-1),<span class="string">'.'</span>,<span class="string">'_'</span>);

Indexes1a=strfind(filename1,<span class="string">'['</span>); <span class="comment">%the initial time</span>
Indexes1b=strfind(filename1,<span class="string">']'</span>); <span class="comment">%the final time</span>

time1=filename1(Indexes1a+1:Indexes1b-1);
Indexes2=strfind(time1,<span class="string">'.'</span>);
time1([Indexes2(1),Indexes2(2),Indexes2(4),Indexes2(5)])=<span class="string">'_'</span>;
filename1=strcat(date1,<span class="string">'_'</span>,time1,<span class="string">'.mat'</span>);
</pre><pre class="codeinput">mkdir(Params.resultsDir);
filename1=strcat(Params.resultsDir,<span class="string">'\'</span>,filename1);<span class="comment">%where are the matlab results</span>

save(filename1,<span class="string">'Locomotion'</span>);
</pre><pre class="codeinput"> close(hn)
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ListFiles = 

126x1 struct array with fields:

    name
    date
    bytes
    isdir
    datenum

</pre><h2>%% ---------------------------------Arrange the chasing events into an excel file AGREGAR LO QUE FALTA----------------------------<a name="70"></a></h2><pre class="codeinput">[AllChasing,AllAvoiding,AllApproaching]=GetEvents;
</pre><h2>--------------------SAVE SOCIAL EVENTS INTO EXCEL FILE-----------------<a name="71"></a></h2><pre class="codeinput">behaviour=0;

<span class="keyword">for</span> behaviour=1:3
  <span class="keyword">switch</span>(behaviour)
    <span class="keyword">case</span> 1    <span class="comment">%for chasing</span>
        <span class="keyword">if</span> ~isempty(AllChasing)
          SaveSocialData(AllChasing,behaviour,Params.SaveDirectory,Params.exp_name,Chasingobj)
        <span class="keyword">end</span>
    <span class="keyword">case</span> 2  <span class="comment">%for avoiding</span>
          <span class="keyword">if</span> ~isempty(AllAvoiding)
          SaveSocialData(AllAvoiding,behaviour,Params.SaveDirectory,Params.exp_name,Avoidanceobj)
        <span class="keyword">end</span>
    <span class="keyword">case</span> 3  <span class="comment">%for approaching</span>
          <span class="keyword">if</span> ~isempty(AllApproaching)
          SaveSocialData(AllApproaching,behaviour,Params.SaveDirectory,Params.exp_name,Approachingobj)
        <span class="keyword">end</span>
 <span class="keyword">end</span>
<span class="keyword">end</span>


  msgbox(<span class="string">'Finish all'</span>)
</pre><pre class="codeinput"><span class="comment">%END MULTIPLE FILES</span>
<span class="comment">%%BEGIN FOR SELECTED FILES</span>
</pre><pre class="codeinput"><span class="keyword">case</span> 1 <span class="comment">%take single files from the list for further analysis</span>

index_selected = get(h.listAllRFID,<span class="string">'Value'</span>);  <span class="comment">%Select the csv files to work</span>
list = cellstr(get(h.listAllRFID,<span class="string">'String'</span>));
item_selected = list(index_selected,1); <span class="comment">% Convert from cell array to string</span>
nCSV=length(item_selected);

<span class="keyword">for</span> i=1:nCSV <span class="comment">%loop over the original files</span>
</pre><pre class="codeinput">clear <span class="string">ArrayX</span>; <span class="comment">%for x coord.</span>
clear <span class="string">ArrayY</span>; <span class="comment">%for y coord.</span>
clear <span class="string">ArrayXY</span>;
clear <span class="string">ArrayRFID</span>;

ArrayX=[];
ArrayY=[];
ArrayXY=[];
ArrayRFID=[];

 clear <span class="string">Distance</span>;
  clear  <span class="string">VectorX</span>;
  clear  <span class="string">VectorY</span>;
    clear  <span class="string">VectorX1</span>;
  clear  <span class="string">VectorY1</span>;
Distance=[];
VectorX=[];
VectorY=[];
VectorX1=[];
VectorY1=[];



clear <span class="string">MouseArray</span> ;
CSVFile=CSVobj.ReadFilesAllCSV(CSVobj.ListFiles,index_selected(i));<span class="comment">%Use Files Treat to read this file</span>
CSVmiceIDs=CSVobj.miceIDs(CSVobj.ListFiles,index_selected(i));

<span class="comment">%%-------- According to date select RFDI----------------</span>
 IndexFilesDates=findRFIDSubset(item_selected(i),DateFiles);

SelectedDataRFID=RFIDobj.ReadFilesAllDate(RFIDobj.ListFiles,IndexFilesDates);
</pre><h2>Create a wait bar for control<a name="77"></a></h2><pre class="codeinput">hbar = waitbar(0,<span class="string">'Please wait...'</span>);

<span class="comment">% Rearrange the data according to the mice in a multidimensional array</span>

<span class="keyword">for</span> j=1:length(miceList) <span class="comment">%for each mouse</span>
</pre><h2>Clear the variables<a name="78"></a></h2><pre class="codeinput">    clear <span class="string">AuxID</span>
    clear <span class="string">Auxtime</span>
    clear <span class="string">Auxantenna</span>
    clear <span class="string">Iaux</span>
    clear <span class="string">AuxIDn</span>
    clear <span class="string">Auxtimen</span>
    clear <span class="string">Auxantennan</span>
</pre><pre class="codeinput"><span class="comment">%ONLY CONSIDER THE LAST NUMBERS SINCE SOMETIMES THE INITIAL ZERO DISSAPEAR</span>

Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,<span class="string">'UniformOutput'</span>, false);

MouseArray(2:length([CSVFile{1}])+1,1,j)=CSVFile{1}; <span class="comment">%for date</span>
MouseArray(2:length([CSVFile{2}])+1,2,j)=strcat(<span class="string">''''</span>,[CSVFile{2}],<span class="string">''''</span>); <span class="comment">%for time</span>

<span class="keyword">if</span> ~isempty(find(cell2mat(Ind)==1))
</pre><pre class="codeinput">MouseArray(2:length([CSVFile{2}])+1,3,j)=num2cell(CSVFile{3+(find(cell2mat(Ind)==1)-1)*3}); <span class="comment">%for x</span>
MouseArray(2:length([CSVFile{2}])+1,4,j)=num2cell(CSVFile{4+(find(cell2mat(Ind)==1)-1)*3}); <span class="comment">%for y</span>
</pre><h2>--------Found in the RFID selected data the mouse with 2 identities--<a name="81"></a></h2><pre class="codeinput">AuxID=vertcat(SelectedDataRFID{:,1});<span class="comment">%identity</span>
Auxtime=vertcat(SelectedDataRFID{:,3}); <span class="comment">%time</span>
Auxantenna=vertcat(SelectedDataRFID{:,4}); <span class="comment">%antenna</span>
Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1)]; <span class="comment">%find the identity of the respective mouse either with the ribs or head ID</span>

<span class="comment">%for the specific mouse</span>
 AuxIDn=AuxID(Iaux);
 Auxtimen=Auxtime(Iaux);
 Auxantennan=Auxantenna(Iaux);

 <span class="comment">%search the similar time points for each frame in the csv file</span>
  d=knnsearch(datenum(Auxtimen,<span class="string">'HH:MM:SS.FFF'</span>),datenum(CSVFile{2},<span class="string">'HH:MM:SS.FFF'</span>));

  <span class="comment">%save rfid data in a mouse array</span>
    MouseArray(2:length([CSVFile{2}])+1,5,j)=strcat(<span class="string">''''</span>,Auxtimen(d),<span class="string">''''</span>); <span class="comment">%RFID time</span>
    MouseArray(2:length([CSVFile{2}])+1,6,j)=Auxantennan(d); <span class="comment">%antenna rfid</span>
</pre><h2>---------------------------- Treat with the time-------------------------<a name="82"></a></h2><pre class="codeinput">    Timeobj.FrameTime=[CSVFile{2}];
    Timeobj.RFIDTime=Auxtimen(d);

    DeltaTimeFrameRFID=abs(Timeobj.DeltaTime)*1000 ;<span class="comment">%for getting in ms</span>
    MouseArray(2:length([CSVFile{2}])+1,22,j)=num2cell(DeltaTimeFrameRFID);

    <span class="comment">%----------------define time object for sleeping----------------------</span>
    IsSleepingobj.TimeLapseFrameAntenna=DeltaTimeFrameRFID;

    <span class="comment">%------do frame time difference----------------</span>
    FrameTimeDif=abs(Timeobj.FrameTimeDif)*1000; <span class="comment">%for getting in ms</span>
     MouseArray(2:length([CSVFile{2}])+1,23,j)=num2cell(FrameTimeDif);
</pre><h2>In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena<a name="83"></a></h2><pre class="codeinput">    <span class="keyword">if</span> index_selected==1
        I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(1,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(1:I-1,6,j)={<span class="string">''</span>};
        <span class="keyword">end</span>

    <span class="keyword">end</span>
</pre><pre class="codeinput">    MouseArray(2:length([CSVFile{2}])+1,7,j)=AuxIDn(d); <span class="comment">%mouse id</span>
</pre><h2>----------Find is sleeping-------------------------<a name="85"></a></h2><pre class="codeinput">      IsSleepingobj.CoordinateX=MouseArray(:,3,j);
      IsSleepingobj.CoordinateY=MouseArray(:,4,j);
      IsSleepingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,8,j)=num2cell(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping));

     SleepingInterval=IsSleepingobj.IsSleepingInterval(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping)); <span class="comment">%sleeping interval</span>
     SleepingBeg= SleepingInterval(:,1);
     SleepingEnd=SleepingInterval(:,2);
     MouseArray(2:length(SleepingBeg)+1,17,j)=num2cell(SleepingBeg);
     MouseArray(2:length(SleepingEnd)+1,18,j)=num2cell(SleepingEnd);


     <span class="comment">%find the number of the sleeping cage</span>
     MouseArray(2:length([CSVFile{2}])+1,9,j)=num2cell(IsSleepingobj.IsSleepingCage(SleepingInterval));

     <span class="comment">%arrange coordinates for sleeping</span>
     MouseArray(2:length([CSVFile{2}])+1,13:14,j)=num2cell(IsSleepingobj.IsSleepingCoord(SleepingInterval,IsSleepingobj.IsSleepingCage(SleepingInterval)));
</pre><pre class="codeinput">       <span class="comment">%%-------------------------------- Find is hiding----------------------------------------</span>
      IsHidingobj.CoordinateX=MouseArray(:,13,j);<span class="comment">%use the coordinates after the correction of sleeping</span>
      IsHidingobj.CoordinateY=MouseArray(:,14,j);
      IsHidingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,10,j)=num2cell(IsHidingobj.IsHiding);

       <span class="comment">%find hiding interval</span>

     HidingInterval=IsHidingobj.IsHidingInterval(IsHidingobj.IsHiding); <span class="comment">%sleeping interval</span>
     HidingBeg= HidingInterval(:,1);
     HidingEnd=HidingInterval(:,2);
     MouseArray(2:length(HidingBeg)+1,19,j)=num2cell(HidingBeg);
     MouseArray(2:length(HidingEnd)+1,20,j)=num2cell(HidingEnd);

     <span class="comment">%find the number of the hiding box</span>
     MouseArray(2:length([CSVFile{2}])+1,11,j)=num2cell(IsHidingobj.IsHidingCage(HidingInterval));

      <span class="comment">%arrange coordinates for hiding</span>
     MouseArray(2:length([CSVFile{2}])+1,15:16,j)=num2cell(IsHidingobj.IsHidingCoord(HidingInterval,IsHidingobj.IsHidingCage(HidingInterval)));
</pre><pre class="codeinput">     <span class="comment">%-----------------------------Find is in the arena-------------------------------------</span>
    <span class="comment">%find the interval for in arena</span>
     InArenaobj.IsSleeping=MouseArray(:,8,j);
     InArenaobj.IsHiding=MouseArray(:,10,j);
     InArenaobj.AntennaNumber=Auxantennan(d);

     MouseArray(2:length([CSVFile{2}])+1,12,j)=num2cell(InArenaobj.InArena);
</pre><h2>Addition number of frame<a name="88"></a></h2><pre class="codeinput">     MouseArray(2:length([CSVFile{2}])+1,21,j)=num2cell([0:length([CSVFile{2}])-1]');
</pre><h2>%% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena<a name="89"></a></h2><pre class="codeinput">    <span class="keyword">if</span> index_selected==1
        I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(2,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(2:length([CSVFile{2}])+1,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(2:I-1,12,j)=num2cell(0);
        <span class="keyword">end</span>

    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">else</span> <span class="comment">%if the mouse doesn't exit</span>
  <span class="comment">%MouseArray(:,3,j)={''};</span>
  MouseArray(:,:,j)={<span class="string">'0'</span>};
<span class="keyword">end</span>
</pre><h2>------------------ Save to excel file---------------------------------<a name="91"></a></h2><p>Titles</p><pre class="codeinput">MouseArray(1,1,j)={<span class="string">'Experiment Date'</span>};
MouseArray(1,2,j)={<span class="string">'Experiment Time'</span>};
MouseArray(1,3,j)={<span class="string">'Original x coord.'</span>};
MouseArray(1,4,j)={<span class="string">'Original y coord.'</span>};
MouseArray(1,5,j)={<span class="string">'RFID Time'</span>};
MouseArray(1,6,j)={<span class="string">'Number RFID antenna'</span>};
MouseArray(1,7,j)={<span class="string">'RFID mouse identity'</span>};
MouseArray(1,8,j)={<span class="string">'Is Sleeping'</span>};
MouseArray(1,9,j)={<span class="string">'Sleeping Box'</span>};
MouseArray(1,10,j)={<span class="string">'Is Hiding'</span>};
MouseArray(1,11,j)={<span class="string">'Hiding Box'</span>};
MouseArray(1,12,j)={<span class="string">'In Arena'</span>};
MouseArray(1,13,j)={<span class="string">'Coord x with Sleeping'</span>};
MouseArray(1,14,j)={<span class="string">'Coord y with Sleeping'</span>};
MouseArray(1,15,j)={<span class="string">'Coord x with Hiding/Sleeping'</span>};
MouseArray(1,16,j)={<span class="string">'Coord y with Hiding/Sleeping'</span>};
MouseArray(1,17,j)={<span class="string">'Beg.Int.Sleeping'</span>};
MouseArray(1,18,j)={<span class="string">'End Int.Sleeping'</span>};
MouseArray(1,19,j)={<span class="string">'Beg.Int.Hiding'</span>};
MouseArray(1,20,j)={<span class="string">'End.Int.Hiding'</span>};
MouseArray(1,21,j)={<span class="string">'Number of video frame'</span>};
MouseArray(1,22,j)={<span class="string">'Elapsed time between Frame and RFID (msec)'</span>};
MouseArray(1,23,j)={<span class="string">'Elapsed time between frames (msec)'</span>};
MouseArray(1,24,j)={<span class="string">'Duplicates in coord. at arena'</span>};
MouseArray(1,25,j)={<span class="string">'Non defined coord. at arena'</span>};
MouseArray(1,26,j)={<span class="string">'Velocity without repeats in (cm/sec)'</span>};
MouseArray(1,27,j)={<span class="string">'Distance from antenna for duplicates (mm)'</span>};
MouseArray(1,28,j)={<span class="string">'X corrected coord.'</span>};
MouseArray(1,29,j)={<span class="string">'Y corrected coord.'</span>};
MouseArray(1,30,j)={<span class="string">'X interpolated coord.'</span>};
MouseArray(1,31,j)={<span class="string">'Y interpolated coord.'</span>};
MouseArray(1,32,j)={<span class="string">'X interpolated coord. with repeats'</span>};
MouseArray(1,33,j)={<span class="string">'Y interpolated coord. with repeats'</span>};
MouseArray(1,34,j)={<span class="string">'In Arena velocity with real time between frames'</span>};
MouseArray(1,35,j)={<span class="string">'In Arena velocity with real time between frames with interpol.'</span>};
MouseArray(1,36,j)={<span class="string">'Is stop'</span>};
MouseArray(1,37,j)={<span class="string">'Is walking'</span>};
MouseArray(1,38,j)={<span class="string">'Is running'</span>};
MouseArray(1,39,j)={<span class="string">'Is eating'</span>};
MouseArray(1,40,j)={<span class="string">'Is drinking'</span>};
MouseArray(1,41,j)={<span class="string">'Is in zone inside'</span>};
MouseArray(1,42,j)={<span class="string">'Is in zone outside'</span>};
<span class="comment">%</span>
</pre><pre class="codeinput">   ArrayX=[ArrayX,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15,j))];
   ArrayY=[ArrayY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,16,j))];
   ArrayXY=[ArrayXY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15:16,j))];
   ArrayRFID=[ArrayRFID,(MouseArray(2:length([CSVFile{2}])+1,6,j))];
</pre><pre class="codeinput"><span class="comment">%  sheet=char(miceList(j));</span>
<span class="comment">%  Namef=char(item_selected(i));</span>
<span class="comment">%  filename=strcat(Namef(1:end-4),'LocomotionResults','.xlsx');</span>
<span class="comment">%  filename=strrep(filename,'[','(');</span>
<span class="comment">%   filename=strrep(filename,']',')');</span>
<span class="comment">%   filename=strcat(Params.SaveDirectory,'\',filename);</span>
<span class="comment">%  xlswrite(filename,MouseArray(:,:,j),sheet);</span>

 <span class="comment">%Control of wait bar</span>
 waitbar(j/length(miceList));
</pre><pre class="codeinput"><span class="keyword">end</span>
close(hbar)
</pre><h2>-------------------Treat spetial cases-----------------------<a name="95"></a></h2><pre class="codeinput"><span class="comment">%---------------Find repeated Frames for further use-------------------</span>

<span class="comment">% RepeatedFrames=CSVobj.RemoveDuplicFrame([CSVFile{3:end}]);</span>
  RepeatedFrames=CSVobj.RemoveDuplicFrame(ArrayXY);
</pre><h2>-------------------Add to the actual time line the missing position from the excel file fm----------<a name="96"></a></h2><pre class="codeinput">   <span class="keyword">if</span> Params.ForMissingPosition==1 <span class="comment">%if the csv file of missing positions is considered</span>
<span class="comment">%</span>
      clear <span class="string">CSVMissingFile</span>;
      MissingWhiteobj.Number_Mouse=length(miceList);
<span class="comment">%</span>
    TimeMissingFile=CSVMissingobj.ReadTimeMissingPosition(CSVobj.ListFiles,index_selected(i),length(miceList));<span class="comment">%Read the csv file of missing positions</span>
    CoordMissingFile=CSVMissingobj.ReadPositionMissingPosition(CSVobj.ListFiles,index_selected(i),length(miceList));
<span class="comment">%</span>
   Timeline=[CSVFile{2}];
<span class="comment">%    %Add missing positions to the correct mouse</span>
  [ArrayXMissing,ArrayYMissing]=MissingWhiteobj.FindMissingWhite(Timeline,RepeatedFrames,TimeMissingFile,CoordMissingFile(:,3:end));
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%</span>
   <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="comment">%----------------Identified in the arena duplicates and no video ---</span>

hbar=waitbar(0,<span class="string">'Second part wait'</span>)
<span class="keyword">for</span> j=1:length(miceList)
    clear <span class="string">InArenaNonDefined</span>;
    clear <span class="string">InArenaDuplicates</span>;
    clear <span class="string">InArenaAuxiliary</span>;
     Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,<span class="string">'UniformOutput'</span>, false);

    <span class="keyword">if</span> ~isempty(find(cell2mat(Ind)==1))
</pre><pre class="codeinput">      <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
        InArenaNonDefined=InArenaobj.InArenaNonDefined(ArrayX,ArrayY,j,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length(miceList),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        <span class="comment">%InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length( CSVmiceIDs),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));</span>
        MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(InArenaDuplicates);
        MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);
      <span class="keyword">else</span>

        MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(0);<span class="comment">%for cases it is inside the cage all along the file</span>
        MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(0);

      <span class="keyword">end</span>
</pre><h2>---------------- Calculate velocity -----------------<a name="99"></a></h2><pre class="codeinput">       <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
          InArenaVelocity=InArenaobj.InArenaVelocity(RepeatedFrames,ArrayX(:,j),ArrayY(:,j), (cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j))));
          MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(InArenaVelocity);
       <span class="keyword">else</span>
          MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(0); <span class="comment">%for cases it is inside the cage all along the file</span>
       <span class="keyword">end</span>
</pre><h2>-------------------Calculate distance to antenna-------------------------------<a name="100"></a></h2><pre>   InArena.AntennaNumber= MouseArray(2:length([CSVFile{2}])+1,6,j);</pre><pre class="codeinput">       <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
         InArenaAntennaDistance=InArenaobj.InArenaAntennaDistance(ArrayX(:,j),ArrayY(:,j),InArenaDuplicates,MouseArray(2:length([CSVFile{2}])+1,6,j));
         MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell( InArenaAntennaDistance);
       <span class="keyword">else</span>

          MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell(0); <span class="comment">%for cases it is inside the cage all along the file</span>

       <span class="keyword">end</span>
</pre><h2>------------------------Correct the coordinates-----------------------------------<a name="101"></a></h2><pre class="codeinput">      <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
</pre><pre class="codeinput">          j
</pre><h2>--------Add correction to non defined correction in the case of having the excel file with positions------<a name="103"></a></h2><pre class="codeinput">          <span class="keyword">if</span> Params.ForMissingPosition==1 <span class="comment">%if the csv file of missing positions is considered</span>


           InArenaCorrectedNonDefinedCoord=InArenaobj.InArenaCorrectedNonDefinedCoord(ArrayX(:,j),ArrayY(:,j),j,RepeatedFrames,InArenaNonDefined,ArrayRFID,ArrayXMissing,ArrayYMissing);
              MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedNonDefinedCoord(:,1));
           MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedNonDefinedCoord(:,2));
             InArenaNonDefined=InArenaCorrectedNonDefinedCoord(:,3);
             MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);<span class="comment">%readjust values</span>
             ArrayX(:,j)=InArenaCorrectedNonDefinedCoord(:,1);
             ArrayY(:,j)=InArenaCorrectedNonDefinedCoord(:,2);
          <span class="keyword">end</span>
</pre><h2>%% --------Add correction to  duplicate position with different detection antenna in the case of having the excel file with positions------<a name="104"></a></h2><pre>         if Params.ForMissingPosition==1 %if the csv file of missing positions is considered</pre><pre>          InArenaCorrectedDuplicated=InArenaobj.InArenaCorrectedNonDefinedCoord(ArrayX(:,j),ArrayY(:,j),j,RepeatedFrames,InArenaDuplicates,ArrayRFID,ArrayXMissing,ArrayYMissing);</pre><pre>             MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedDuplicated(:,1));
          MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedDuplicated(:,2));
            InArenaDuplicates=InArenaCorrectedDuplicated(:,3);
            MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell( InArenaDuplicates);%readjust values
            ArrayX(:,j)=InArenaCorrectedDuplicated(:,1);
            ArrayY(:,j)=InArenaCorrectedDuplicated(:,2);
         end</pre><pre class="codeinput">           InArenaCorrectedCoord=InArenaobj.InArenaCorrectedCoord(ArrayX(:,j),ArrayY(:,j),RepeatedFrames, InArenaAntennaDistance,InArenaDuplicates,InArenaNonDefined,cell2mat(MouseArray(2:length([CSVFile{2}])+1,22,j)),MouseArray(2:length([CSVFile{2}])+1,6,j));
           MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedCoord(:,1));
           MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedCoord(:,2));
</pre><pre class="codeinput">      <span class="keyword">else</span>
           MouseArray(2:length([CSVFile{2}])+1,28,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
           MouseArray(2:length([CSVFile{2}])+1,29,j)=MouseArray(2:length([CSVFile{2}])+1,16,j);<span class="comment">%for cases it is inside the cage all along the file</span>
      <span class="keyword">end</span>
</pre><h2>---------------------------------Interpolate the coordinates-------------------------------<a name="107"></a></h2><pre class="codeinput">        TimeFrame=cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j));
        <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
          InArenaInterpolation=InArenaobj.InArenaInterpolation(RepeatedFrames,TimeFrame,InArenaCorrectedCoord(:,1),InArenaCorrectedCoord(:,2));
          MouseArray(2:length([CSVFile{2}])+1,30,j)=num2cell(InArenaInterpolation(:,1));
          MouseArray(2:length([CSVFile{2}])+1,31,j)=num2cell(InArenaInterpolation(:,2));
        <span class="keyword">else</span>
           MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
           MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); <span class="comment">%for cases it is inside the cage all along the file</span>
        <span class="keyword">end</span>


<span class="comment">%for eliminate interpolation</span>
<span class="comment">%</span>
<span class="comment">%            MouseArray(2:length([CSVFile{2}])+1,30,j)= MouseArray(2:length([CSVFile{2}])+1,28,j);</span>
<span class="comment">%            MouseArray(2:length([CSVFile{2}])+1,31,j)= MouseArray(2:length([CSVFile{2}])+1,29,j);</span>
<span class="comment">%            InArenaInterpolation(:,1)=InArenaCorrectedCoord(:,1);</span>
<span class="comment">%            InArenaInterpolation(:,2)=InArenaCorrectedCoord(:,2);</span>
</pre><h2>-----------------------------------Return repeated coordinates-------------------------------------------<a name="108"></a></h2><pre class="codeinput">        <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
            InArenaAddRepeats=InArenaobj.InArenaAddRepeats(RepeatedFrames,InArenaInterpolation(:,1),InArenaInterpolation(:,2));
            MouseArray(2:length([CSVFile{2}])+1,32,j)=num2cell(InArenaAddRepeats(:,1));
            MouseArray(2:length([CSVFile{2}])+1,33,j)=num2cell(InArenaAddRepeats(:,2));
        <span class="keyword">else</span>
             MouseArray(2:length([CSVFile{2}])+1,32,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
             MouseArray(2:length([CSVFile{2}])+1,33,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); <span class="comment">%for cases it is inside the cage all along the file</span>
        <span class="keyword">end</span>

              <span class="comment">% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena</span>
     <span class="keyword">if</span> i==1
       I=[];
        <span class="keyword">if</span> cell2mat(MouseArray(1,3,j))==1e6 <span class="comment">%only if the first is million</span>
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,<span class="string">'first'</span>);
        MouseArray(1:I-1,32,j)={<span class="string">''</span>};
        MouseArray(1:I-1,33,j)={<span class="string">''</span>};
        <span class="keyword">end</span>

     <span class="keyword">end</span>
</pre><h2>-------------------------for further use create 2 auxiliary arrays----------------------<a name="109"></a></h2><pre class="codeinput">    clear <span class="string">Iexception1</span>
    clear <span class="string">Iexception2</span>

    <span class="comment">%Consider the cases which are in the arena , not defined (1e6 coord</span>
    <span class="comment">%value) and negative or very big coordinates either x or y.Then in</span>
    <span class="comment">%arena is zero (we cannot say nothing</span>
    Iexception1=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)))&gt;2000 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    Iexception2=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)))&gt;2000 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 &amp; cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);

    <span class="keyword">if</span> ~isempty(find(Iexception1==1))
        MouseArray(Iexception1,12,j)=num2cell([0]);
    <span class="keyword">elseif</span> ~isempty(find(Iexception2==1))
        MouseArray(Iexception2,12,j)=num2cell([0]);

    <span class="keyword">end</span>


    <span class="comment">%-----------------------------------</span>
</pre><h2>-------------------------------------------------In Arena velocity with approximate real time -----------------------------<a name="110"></a></h2><pre class="codeinput">        RealTime=78; <span class="comment">%Real time is 78ms</span>
       <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
        InArenaVelocityR=InArenaobj.InArenaVelocityR(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2),RealTime,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(InArenaVelocityR);
       <span class="keyword">else</span>
          MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(0);  <span class="comment">%for cases it is inside the cage all along the file</span>
       <span class="keyword">end</span>
</pre><h2>----------------------------Determine when it is stop,running, walking according to the velocity----------------------------<a name="111"></a></h2><pre class="codeinput">     InArenaVelocityRInterp=InArenaobj.InArenaVelocityRInterp(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));

<span class="comment">%      InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));</span>
    <span class="comment">%InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)));</span>

   InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,InArenaVelocityRInterp,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));

    MouseArray(2:length([CSVFile{2}])+1,35,j)=num2cell(InArenaVelocityRInterp(:,1));<span class="comment">%add to velocity interpolation where the velocity is zero</span>
    MouseArray(2:length([CSVFile{2}])+1,36,j)=num2cell(InArenaActivity(:,1)); <span class="comment">%stop</span>
    MouseArray(2:length([CSVFile{2}])+1,37,j)=num2cell(InArenaActivity(:,2));<span class="comment">%walking</span>
    MouseArray(2:length([CSVFile{2}])+1,38,j)=num2cell(InArenaActivity(:,3));<span class="comment">%running</span>
</pre><h2>------------------------------------Determine if it is drinking or eating------------------------------------------<a name="112"></a></h2><pre class="codeinput">   <span class="comment">%First complete in all the repeated frames the velocities</span>
   clear <span class="string">InArenaVelocityAllFrames</span>;
   InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,InArenaVelocityRInterp);

     IsEating=IsEatingDrinkingobj. IsEating(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);
     IsDrinking=IsEatingDrinkingobj. IsDrinking(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);

    MouseArray(2:length([CSVFile{2}])+1,39,j)=num2cell(IsEating);<span class="comment">%eating</span>
    MouseArray(2:length([CSVFile{2}])+1,40,j)=num2cell(IsDrinking);<span class="comment">%drinking</span>
</pre><h2>-----------------------------Determine if it is inside or outside a given zone----------------------------<a name="113"></a></h2><pre class="codeinput">    IsZone=IsInZoneobj.IsZone(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)));

    MouseArray(2:length([CSVFile{2}])+1,41,j)=num2cell(IsZone(:,1));<span class="comment">%inner zone</span>
    MouseArray(2:length([CSVFile{2}])+1,42,j)=num2cell(IsZone(:,2));<span class="comment">%outside zone</span>
</pre><h2>-------------------------for further use create 2 auxiliary arrays without repeats----------------------<a name="114"></a></h2><pre class="codeinput">        <span class="keyword">if</span> ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
         InArenaAuxiliary=InArenaobj.InArenaAuxiliary(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2));

         Distance(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,1);
         VectorX(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,2);<span class="comment">%normalized vector</span>
         VectorY(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,3);<span class="comment">%normalized vector</span>

         VectorX1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,4);
         VectorY1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,5);
        <span class="keyword">else</span>
           Distance(1:length(RepeatedFrames)-1,j)=0; <span class="comment">%in the case it is inside all the time</span>
           VectorX(1:length(RepeatedFrames)-1,j)=0;
           VectorY(1:length(RepeatedFrames)-1,j)=0;

           VectorX1(1:length(RepeatedFrames)-1,j)=0;
           VectorY1(1:length(RepeatedFrames)-1,j)=0;

        <span class="keyword">end</span>
</pre><pre class="codeinput"> sheet=char(miceList(j));
 Namef=char(item_selected(i));
 filename=strcat(Namef(1:end-4),<span class="string">'LocomotionResults'</span>,<span class="string">'.xlsx'</span>);
 filename=strrep(filename,<span class="string">'['</span>,<span class="string">'('</span>);
  filename=strrep(filename,<span class="string">']'</span>,<span class="string">')'</span>);
  filename=strcat(Params.SaveDirectory,<span class="string">'\'</span>,filename);
 xlswrite(filename,MouseArray(:,:,j),sheet);
</pre><pre class="codeinput">     <span class="keyword">else</span> <span class="comment">%if the mouse doesn't exit</span>
  MouseArray(:,:,j)=num2cell([0]);

<span class="keyword">end</span>
 waitbar(j/length(miceList));
<span class="keyword">end</span>
</pre><h2>---------------------Save the locomotion parameters as a structure bring  all the mice together----------------------<a name="117"></a></h2><pre class="codeinput">Locomotion.miceList=miceList;
Large=length(MouseArray(:,12,1));
Locomotion.isInArena=reshape(cell2mat(MouseArray(2:Large,12,:)),Large-1,length(miceList));
Locomotion.TrajectoryX=reshape(cell2mat(MouseArray(2:Large,32,:)),Large-1,length(miceList)); <span class="comment">%coord after corrections with repeats</span>
Locomotion.TrajectoryY=reshape(cell2mat(MouseArray(2:Large,33,:)),Large-1,length(miceList));  <span class="comment">%coord after corrections with repeats</span>
<span class="comment">% Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,34,:)),Large-1,length(miceList)); %velocity of the real frames</span>
Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,35,:)),Large-1,length(miceList)); <span class="comment">%velocity of the real frames including interpolation of zero points</span>
Locomotion.InArenaDuplicates=reshape(cell2mat(MouseArray(2:Large,24,:)),Large-1,length(miceList)); <span class="comment">%In arena duplicates</span>

Locomotion.RepeatedFrames=RepeatedFrames;
Locomotion.ExperimentalTime=MouseArray(2:Large,2,1); <span class="comment">%take only one mouse since it is the same time for everything.</span>
Locomotion.VectorX=VectorX; <span class="comment">%without repeats normalized</span>
Locomotion.VectorY=VectorY; <span class="comment">%without repeats normalized</span>
Locomotion.Distance=Distance;<span class="comment">%without repeats normalized</span>
Locomotion.VectorX1=VectorX1; <span class="comment">%without repeats no normalized</span>
Locomotion.VectorY1=VectorY1; <span class="comment">%without repeats no normalized</span>

Locomotion.isStop=reshape(cell2mat(MouseArray(2:Large,36,:)),Large-1,length(miceList));
Locomotion.isWalking=reshape(cell2mat(MouseArray(2:Large,37,:)),Large-1,length(miceList));
Locomotion.isRunning=reshape(cell2mat(MouseArray(2:Large,38,:)),Large-1,length(miceList));

Locomotion.IsEating=reshape(cell2mat(MouseArray(2:Large,39,:)),Large-1,length(miceList));
Locomotion.IsDrinking=reshape(cell2mat(MouseArray(2:Large,40,:)),Large-1,length(miceList));
Locomotion.IsSleeping=reshape(cell2mat(MouseArray(2:Large,8,:)),Large-1,length(miceList));
Locomotion.IsHiding=reshape(cell2mat(MouseArray(2:Large,10,:)),Large-1,length(miceList));
Locomotion.SleepingBox=reshape(cell2mat(MouseArray(2:Large,9,:)),Large-1,length(miceList));
Locomotion.HidingBox=reshape(cell2mat(MouseArray(2:Large,11,:)),Large-1,length(miceList));
Locomotion.IsInsideZone=reshape(cell2mat(MouseArray(2:Large,41,:)),Large-1,length(miceList));
Locomotion.IsOutsideZone=reshape(cell2mat(MouseArray(2:Large,42,:)),Large-1,length(miceList));
</pre><h2>--------------------Compute distance pairs---------------------------<a name="118"></a></h2><pre class="codeinput"> DistancePairs=computeDistancePairsGV(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.IsHiding,Locomotion.RepeatedFrames);
Locomotion.DistancePairs=DistancePairs;
</pre><h2>--------------------Compute if the mice are together----------------------------<a name="119"></a></h2><h2>---------------------------Define object together--------------------------------<a name="120"></a></h2><pre class="codeinput">Togetherobj=Together;
Togetherobj.DistanceToBeTogether=Params.DistanceToBeTogheter; <span class="comment">%distance to be considered together in general is 10cm</span>
Togetherobj.numOfMice=length(Locomotion.miceList);

TogetherCalc=Togetherobj.TogetherCalc(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.RepeatedFrames);
Locomotion.TimesTogether=TogetherCalc(1,length(Locomotion.miceList)+1);
Locomotion.TogetherAll=TogetherCalc(1,1:length(Locomotion.miceList));
</pre><pre class="codeinput"><span class="comment">%------------Save as a mat file---------------------------</span>
filename1=strcat(Namef(1:end-4),<span class="string">'.mat'</span>);
filename1=strcat(Params.SaveDirectory,<span class="string">'\'</span>,filename1);

save(filename1,<span class="string">'Locomotion'</span>)
</pre><h2>-------------------------------Calculating chasing-----------------------------<a name="122"></a></h2><pre class="codeinput"><span class="comment">%---------Create chasing object-------------------</span>

Chasingobj=Chasing;
Chasingobj.numOfMice=length(Locomotion.miceList);
Chasingobj.Dist_tresh1=300;
Chasingobj.Velocity_Tresh=0.5;
Chasingobj.PathTresh=600;
Chasingobj.Dist_tresh2=200;

<span class="comment">% Chasingobj.AngleMaximum1=20; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.</span>
<span class="comment">% Chasingobj.AngleMaximum2=20; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.</span>
<span class="comment">% Chasingobj.MinimumPath=200; %This is the minimum path recording to be considered as chasing.</span>
<span class="comment">% Chasingobj.GapPath=400; %This is the gap between the chasing that it is allow in units of mm</span>
<span class="comment">% Chasingobj.ThreshVelocity=10; %20-10 cm/sec</span>
<span class="comment">% Chasingobj.GapFrames=100; %maximum number of frames to be allowed to be a gap</span>
<span class="comment">% Chasingobj.GapPathEnd=200; %for the beginning and end of chasing interval</span>



Chasingobj.AngleMaximum1=Params.AngleMaximum1; <span class="comment">%This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.</span>
Chasingobj.AngleMaximum2=Params.AngleMaximum2; <span class="comment">%This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.</span>
Chasingobj.MinimumPath=Params.editpar1; <span class="comment">%This is the minimum path recording to be considered as chasing.</span>
Chasingobj.GapPath=Params.editpar2; <span class="comment">%This is the maximum distance allow to finish the chasing mm</span>
Chasingobj.ThreshVelocity=Params.editpar3; <span class="comment">%20-10 cm/sec</span>
Chasingobj.GapFrames=Params.editpar4; <span class="comment">%maximum number of frames to be allowed to be a gap</span>
Chasingobj.GapPathEnd=Params.editpar5;

Chasingobj.GapFramesS=Params.editpar6; <span class="comment">%maximum number of frames to be allowed to be a gap in small frames</span>
Chasingobj.GapPathEndS=Params.editpar7;<span class="comment">% condition of the end of the frame in small frames</span>


<span class="comment">%-------------------------Chasing after coord correction---------------</span>

TrajectoryX=Locomotion.TrajectoryX(Locomotion.RepeatedFrames,:);
TrajectoryY=Locomotion.TrajectoryY(Locomotion.RepeatedFrames,:);
Velocity=Locomotion.Velocity(Locomotion.RepeatedFrames,:);


<span class="comment">% ChasingCal=Chasingobj.ChasingCal(TrajectoryX,TrajectoryY,Locomotion.Velocity(Locomotion.RepeatedFrames,:),Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.VectorX,Locomotion.VectorY,Locomotion.Distance,Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:))</span>

 ChasingCalvs2=Chasingobj.ChasingCalvs2(TrajectoryX,TrajectoryY,Locomotion.VectorX1,Locomotion.VectorY1,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Velocity,Locomotion.InArenaDuplicates(Locomotion.RepeatedFrames,:));

<span class="comment">% Locomotion.ChasingAll=ChasingCal(:,1:Chasingobj.numOfMice);</span>
<span class="comment">% Locomotion.ChasedAll=ChasingCal(:,Chasingobj.numOfMice+1:2*Chasingobj.numOfMice);</span>
<span class="comment">% Locomotion.MoveTogether=ChasingCal(:,2*Chasingobj.numOfMice+1:3*Chasingobj.numOfMice);</span>
<span class="comment">% Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);</span>
Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);
Locomotion.BeingChasingAll=ChasingCalvs2(:,Chasingobj.numOfMice+1:Chasingobj.numOfMice+Chasingobj.numOfMice);
Locomotion.TimeWithoutRepeats=Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:);
</pre><pre class="codeinput">msgbox(<span class="string">'Chasing analysis finish'</span>)


<span class="comment">% %% %------------Save as a mat file---------------------------</span>
filename1=strcat(Namef(1:end-4),<span class="string">'.mat'</span>);
filename1=strcat(Params.SaveDirectory,<span class="string">'\'</span>,filename1);

save(filename1,<span class="string">'Locomotion'</span>);
</pre><pre class="codeinput">msgbox(<span class="string">'Finish'</span>)
</pre><pre class="codeinput"><span class="keyword">end</span>



<span class="comment">%Results.miceList=miceList;</span>
<span class="comment">%Results.MouseArray=MouseArray;</span>
 <span class="comment">%save(mat according the date)</span>



<span class="keyword">end</span>

<span class="comment">% %% ---------------------------------Arrange the chasing events into an excel file AGREGAR LO QUE FALTA----------------------------</span>
<span class="comment">% AllChasing=GetEvents;</span>
<span class="comment">% %%   %% save into an excel file in a sheet called list of all chasing events</span>
<span class="comment">%   raw={};</span>
<span class="comment">%   raw(1,1)={'Experiment date'};</span>
<span class="comment">%   raw(1,2)={'Time begin event'};</span>
<span class="comment">%   raw(1,3)={'Time end event'};</span>
<span class="comment">%   raw(1,4)={'Chasing mouse'};</span>
<span class="comment">%   raw(1,5)={'Chased mouse'};</span>
<span class="comment">%   raw(1,6)={'Corrected events'};</span>
<span class="comment">%   raw(1,7)={'Frame begin chasing'};</span>
<span class="comment">%   raw(1,8)={'Frame finish chasing'};</span>
<span class="comment">%   raw(1,9)={'Number of Event'};</span>
<span class="comment">%</span>
<span class="comment">%   raw(2:size(AllChasing,1)+1,1:8)=AllChasing;</span>
<span class="comment">%    raw(2:size(AllChasing,1)+1,9)=num2cell([1:size(AllChasing,1)]');</span>
<span class="comment">% %   experi=get(h.editAllRFID2,'string');</span>
<span class="comment">%  % datadirec=get(h.edit3x,'string') %choice final sheet</span>
<span class="comment">%</span>
<span class="comment">% %   DateOrder=OrderFilename(raw(2:end,1)); %order the first part of the date</span>
<span class="comment">% % [value,indexes]=sort(DateOrder,'ascend');</span>
<span class="comment">% % raw(2:length(DateOrder)+1,:)=raw(indexes+1,:);</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%   %%</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%   sheet=['Chasing'];</span>
<span class="comment">%   xlswrite([Params.SaveDirectory,'\','ChasingResults.xlsx'],raw,sheet)</span>
<span class="comment">%close(hbar)</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2>%% Auxiliary functions<a name="130"></a></h2><pre class="codeinput"><span class="keyword">function</span> XY=rescaleCoordinatesGV(XY,Corners,max_width)
XY=(XY-repmat(Corners(1,:),size(XY,1),1))<span class="keyword">...</span><span class="comment">,</span>
    ./repmat(Corners(3,:)-Corners(1,:),size(XY,1),1)*max_width; <span class="comment">% max_wd - mm</span>

<span class="keyword">end</span>
</pre><h2>find  the last numbers<a name="131"></a></h2><pre class="codeinput"><span class="keyword">function</span> result=Find4last(x,a)
x=char(x);
T=strfind(x(end-6:end),a);
<span class="keyword">if</span> isempty(T)
result=0;
<span class="keyword">else</span>
result=1;
<span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>find RFID subset with the same date as the selected csv file<a name="132"></a></h2><pre class="codeinput"><span class="keyword">function</span> IndexFilesDates=findRFIDSubset(FileSelected,DateFiles)
FileSelected=char(FileSelected);
Lim=strfind(FileSelected,<span class="string">'-'</span>);
x=datenum(FileSelected(1:Lim-1),<span class="string">'dd.mm.yyyy'</span>);
IndexFilesDates=find(DateFiles==x);

<span class="keyword">end</span>
</pre><h2>Find the time near to the RFID data for each frame<a name="133"></a></h2><pre class="codeinput"><span class="keyword">function</span> result=FoundNearTime(x,RFIDDataTime)

xTime=datevec(x,<span class="string">'HH:MM:SS.FFF'</span>);
TimeDif=abs(etime(RFIDDataTime,repmat(xTime,size(RFIDDataTime,1),1)));

<span class="comment">%find the nearest time of rfid to frame video</span>
result=find(TimeDif==min(TimeDif));
result=result(1);


<span class="keyword">end</span>
</pre><h2>Arrange the coordinates in an horizontal way<a name="134"></a></h2><pre class="codeinput"><span class="keyword">function</span> [X,Y]=ArrangeHoriz(AuxArray,L)
X=[];
Y=[];
<span class="keyword">for</span> j=1:L
     X=[X, AuxArray(:,1,j)];
     Y=[Y, AuxArray(:,2,j)];
<span class="keyword">end</span>


<span class="keyword">end</span>
</pre><h2>To calculate distance between pair of mice-If one is in the arena/hiding or sleeping box  and vicevers  or both sleeping is NAN no information<a name="135"></a></h2><pre class="codeinput"><span class="comment">%FOR THIS CALCULATION NO REPEATED WERE CONSIDERED</span>
<span class="comment">%THE DISTANCES WERE CALCULATED IN MM</span>
<span class="keyword">function</span> DistancePairs=computeDistancePairsGV(TrajectoryX,TrajectoryY,isInArena,IsHiding,RepeatedFrames)
</pre><h2>----------Clear variables---------<a name="137"></a></h2><pre class="codeinput">a=[];
b=[];
c=[];
d=[];
</pre><pre class="codeinput">numOfMice=size(TrajectoryX,2);
dist=@(x1,x2) sqrt(sum((x1-x2).^2,2));
</pre><pre class="codeinput"><span class="comment">%Remove repeats</span>
TrajectoryX=TrajectoryX(RepeatedFrames,:);
TrajectoryY=TrajectoryY(RepeatedFrames,:);
isInArena=isInArena(RepeatedFrames,:);
IsHiding=IsHiding(RepeatedFrames,:);
</pre><pre class="codeinput"><span class="keyword">for</span> i=1:numOfMice
    <span class="keyword">for</span> j=1:numOfMice
        DistancePairs(:,i,j)=dist([TrajectoryX(:,i) TrajectoryY(:,i)],[TrajectoryX(:,j) TrajectoryY(:,j)]);

        a=~isInArena(:,i)&amp;~isInArena(:,j);<span class="comment">%both are not in arena</span>
        c=~isInArena(:,i)&amp;~IsHiding(:,i); <span class="comment">%is not in the arena and it is not hiding</span>
        d=~isInArena(:,j)&amp;~IsHiding(:,j); <span class="comment">%is not in the arena and it is not hiding</span>

        DistancePairs(c|d,i,j)=NaN; <span class="comment">%if one is in the arena and the other outiside or viceversa or both outside thus no information</span>


<span class="comment">%         b=(a==1) &amp; (HidingBox(:,i)~=0) &amp; (HidingBox(:,j)~=0) &amp; (HidingBox(:,i)==HidingBox(:,j)); %if aren't in the arena and they are both in the hiding box thus the distance is zero</span>
<span class="comment">%              DistancePairs(b,i,j)=0;</span>




    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><h2>-----------------------Function for saving Chasing, approachin/avoiding into an excel file------------------<a name="142"></a></h2><pre class="codeinput"><span class="keyword">function</span> SaveSocialData(Social_Data,behaviour,SaveDirectory,exp_name,SocialObj)

<span class="keyword">if</span> behaviour==1 <span class="comment">%chasing</span>
</pre><pre class="codeinput">  <span class="comment">%Separate the duplicates from the data and save in another sheet</span>
  [Social_Data,DoubleData]=RemoveDuplicates(Social_Data);
</pre><h2>%%   %% save into an excel file in a sheet called list of all chasing events<a name="144"></a></h2><pre class="codeinput">  raw={};
  raw(1,1)={<span class="string">'Experiment date'</span>};
  raw(1,2)={<span class="string">'Time begin event'</span>};
  raw(1,3)={<span class="string">'Time end event'</span>};
  raw(1,4)={<span class="string">'Chasing mouse'</span>};
  raw(1,5)={<span class="string">'Chased mouse'</span>};
  raw(1,6)={<span class="string">'Corrected events'</span>};
  raw(1,7)={<span class="string">'Frame begin chasing'</span>};
  raw(1,8)={<span class="string">'Frame finish chasing'</span>};
  raw(1,9)={<span class="string">'Small Events'</span>};
  raw(1,10)={<span class="string">'Number of Event'</span>};

 <span class="comment">% raw(2:size(Social_Data,1)+1,1:9)=Social_Data;</span>
</pre><h2>Sort the data according to the days<a name="145"></a></h2><pre class="codeinput">  <span class="keyword">for</span> i=1:length(Social_Data(:,1))
      Ax=char(strrep(Social_Data(i,1),<span class="string">''''</span>,<span class="string">''</span>)); <span class="comment">%remove every comma</span>
    k=strfind(Ax,<span class="string">'_'</span>);

    formatIn = <span class="string">'dd_mm_yyyy'</span>;
    DateString=Ax(1:k(3)-1);
    DateNum(i)=datenum(DateString,formatIn); <span class="comment">%this is done if there was a change in month</span>


<span class="keyword">end</span>
 [~,idDateSort]=sort(DateNum);
 Social_Data=Social_Data(idDateSort,:);

  raw(2:size(Social_Data,1)+1,1:9)=Social_Data;
</pre><pre class="codeinput">  raw(2:size(Social_Data,1)+1,10)=num2cell([1:size(Social_Data,1)]');

  sheet=[<span class="string">'Chasing'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'ChasingResults.xlsx'</span>],raw,sheet)
</pre><h2>Save in another sheet data which appear as duplicate and it is not sure<a name="147"></a></h2><pre class="codeinput">  raw1={};
  raw1(1,1)={<span class="string">'Experiment date'</span>};
  raw1(1,2)={<span class="string">'Time begin event'</span>};
  raw1(1,3)={<span class="string">'Time end event'</span>};
  raw1(1,4)={<span class="string">'Chasing mouse'</span>};
  raw1(1,5)={<span class="string">'Chased mouse'</span>};
  raw1(1,6)={<span class="string">'Corrected events'</span>};
  raw1(1,7)={<span class="string">'Frame begin chasing'</span>};
  raw1(1,8)={<span class="string">'Frame finish chasing'</span>};
  raw1(1,9)={<span class="string">'Small Events'</span>};
  raw1(1,10)={<span class="string">'Number of Event'</span>};

  raw1(2:size(DoubleData,1)+1,1:9)=DoubleData;

  raw1(2:size(DoubleData,1)+1,10)=num2cell([1:size(DoubleData,1)]');

  sheet1=[<span class="string">'ChasingNoDefinedData'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'ChasingResults.xlsx'</span>],raw1,sheet1)
</pre><h2>Save in another sheet all the parameters<a name="148"></a></h2><pre class="codeinput">  raw2={};
  raw2(1,1)={<span class="string">'Angle of 1-2 with movement 1 (degree)'</span>};
  raw2(2,1)={<span class="string">'Angle of movement 1 with movement 2 (degree)'</span>};
  raw2(3,1)={<span class="string">'Minimum path done by the mouse to be considered chasing (mm)'</span>};
  raw2(4,1)={<span class="string">'Maximum distance between mice allow in a chasing event (mm)'</span>};
  raw2(5,1)={<span class="string">'Minimum velocity to be considered in a chasing event (cm/sec)'</span>};
  raw2(6,1)={<span class="string">'Maximum number of frames  between events allow to join between them'</span>};
  raw2(7,1)={<span class="string">'Maximum mice distance between events allow to join events(mm)'</span>};
  raw2(8,1)={<span class="string">'Maximum number of frames  between SMALL events allow to join between them'</span>};
  raw2(9,1)={<span class="string">'Maximum mice distance between SMALL events allow to join events (mm)'</span>};

   raw2(1,2)=num2cell(SocialObj.AngleMaximum1);
  raw2(2,2)=num2cell(SocialObj.AngleMaximum2);
  raw2(3,2)=num2cell(SocialObj.MinimumPath);
  raw2(4,2)=num2cell(SocialObj.GapPath);
  raw2(5,2)=num2cell(SocialObj.ThreshVelocity);
  raw2(6,2)=num2cell(SocialObj.GapFrames);
  raw2(7,2)=num2cell(SocialObj.GapPathEnd);
  raw2(8,2)=num2cell(SocialObj.GapFramesS);
  raw2(9,2)=num2cell(SocialObj.GapPathEndS);


 sheet2=[<span class="string">'ChasingParameters'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'ChasingResults.xlsx'</span>],raw2,sheet2)
</pre><pre class="codeinput"><span class="keyword">elseif</span> behaviour==2 <span class="comment">%avoiding</span>
</pre><h2>%%   %% save into an excel file in a sheet called list of all avoiding events<a name="151"></a></h2><pre class="codeinput">  raw={};
  raw(1,1)={<span class="string">'Experiment date'</span>};
  raw(1,2)={<span class="string">'Time begin event'</span>};
  raw(1,3)={<span class="string">'Time end event'</span>};
  raw(1,4)={<span class="string">'Avoiding mouse'</span>};
  raw(1,5)={<span class="string">'Being avoiding mouse'</span>};
  raw(1,6)={<span class="string">'Corrected events'</span>};
  raw(1,7)={<span class="string">'Frame begin avoiding'</span>};
  raw(1,8)={<span class="string">'Frame finish avoiding'</span>};
  raw(1,9)={<span class="string">'Number of Event'</span>};

  raw(2:size(Social_Data,1)+1,1:8)=Social_Data;
  raw(2:size(Social_Data,1)+1,9)=num2cell([1:size(Social_Data,1)]');

  sheet=[<span class="string">'Avoiding'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'AvoidingResults.xlsx'</span>],raw,sheet)

 <span class="comment">%Save in another sheet all the parameters</span>
  raw2={};
  raw2(1,1)={<span class="string">'Max. distance between mice to be considered avoiding event(mm)'</span>};
  raw2(2,1)={<span class="string">'Fine tuning of the distance for avoiding event (mm)'</span>};
  raw2(3,1)={<span class="string">'Velocity of avoiding (cm/sec)'</span>};
  raw2(4,1)={<span class="string">'Radius for avoiding (mm)'</span>};


   raw2(1,2)=num2cell(SocialObj.Distance_thresh);
  raw2(2,2)=num2cell(SocialObj.Dist_thresh_Fine_Tuning);
  raw2(3,2)=num2cell(SocialObj.velThr);
  raw2(4,2)=num2cell(SocialObj.R);



 sheet2=[<span class="string">'AvoidingParameters'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'AvoidingResults.xlsx'</span>],raw2,sheet2)
</pre><pre class="codeinput"><span class="keyword">elseif</span> behaviour==3 <span class="comment">%approaching</span>
</pre><h2>%%   %% save into an excel file in a sheet called list of all approaching events<a name="154"></a></h2><pre class="codeinput">  raw={};
  raw(1,1)={<span class="string">'Experiment date'</span>};
  raw(1,2)={<span class="string">'Time begin event'</span>};
  raw(1,3)={<span class="string">'Time end event'</span>};
  raw(1,4)={<span class="string">'Approaching mouse'</span>};
  raw(1,5)={<span class="string">'Be approached mouse'</span>};
  raw(1,6)={<span class="string">'Corrected events'</span>};
  raw(1,7)={<span class="string">'Frame begin approaching'</span>};
  raw(1,8)={<span class="string">'Frame finish approaching'</span>};
  raw(1,9)={<span class="string">'Number of Event'</span>};

  raw(2:size(Social_Data,1)+1,1:8)=Social_Data;
  raw(2:size(Social_Data,1)+1,9)=num2cell([1:size(Social_Data,1)]');

  sheet=[<span class="string">'Approaching'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'ApproachingResults.xlsx'</span>],raw,sheet)

 <span class="comment">%Save in another sheet all the parameters</span>
  raw2={};
  raw2(1,1)={<span class="string">'Max. distance between mice to be considered approaching event(mm)'</span>};
  raw2(2,1)={<span class="string">'Fine tuning of the distance for approaching event (mm)'</span>};
  raw2(3,1)={<span class="string">'Velocity of the approached mouse (cm/sec)'</span>};
  raw2(4,1)={<span class="string">'Correlation factor between mice'</span>};


  raw2(1,2)=num2cell(SocialObj.Distance_thresh);
  raw2(2,2)=num2cell(SocialObj.distTr);
  raw2(3,2)=num2cell(SocialObj.velTr2);
  raw2(4,2)=num2cell(SocialObj.CorrelFactor);



 sheet2=[<span class="string">'ApproachingParameters'</span>];
  xlswrite([SaveDirectory,<span class="string">'\'</span>,exp_name,<span class="string">'_'</span>,<span class="string">'ApproachingResults.xlsx'</span>],raw2,sheet2)
</pre><pre class="codeinput"><span class="keyword">end</span>




<span class="keyword">end</span>
</pre><h2>-----------For removing duplicates from excel file------------------<a name="156"></a></h2><pre class="codeinput"><span class="keyword">function</span> [Social_Data,DoubleData]=RemoveDuplicates(Social_Data)

   BegFrameEndFrame=cell2mat(Social_Data(:,7:8));
   A=[1:length(BegFrameEndFrame(:,1))]';
   [C,ia,ic]=unique(BegFrameEndFrame,<span class="string">'rows'</span>,<span class="string">'stable'</span>);<span class="comment">%eliminate the duplicates</span>
   IndWithDuplicates=setdiff(A,ia,<span class="string">'rows'</span>);
   Duplicates=BegFrameEndFrame(IndWithDuplicates,:);
   Lia=ismember(BegFrameEndFrame,Duplicates,<span class="string">'rows'</span>);<span class="comment">%find this duplicates in original data</span>
   AuxData=Social_Data(find(Lia(:,1)==1),:);<span class="comment">%this is data of duplicates</span>
   Iaux=find(Lia(:,1)==1);
   Iaux1=setdiff(A,Iaux,<span class="string">'rows'</span>);
   DoubleData=Social_Data(Iaux,:);
   Social_Data=Social_Data(Iaux1,:);



<span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####

function ManagerComputeAll( ~,~ )
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHVariablesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

global h
clc
clear MouseArray;
clear ArrayX; %for x coord.
clear ArrayY; %for y coord.
clear ArrayXY;
ArrayX=[];
ArrayY=[];
ArrayXY=[];
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-ParametersREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
Params=ParametersComputeAll;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHRead Mat FilesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH



%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHRead Parameters of csv filesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
CSVobj=FilesTreat;%use class FilesTreat
CSVobj.directory=Params.DataDir;
CSVobj.extension='.csv';


%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHSelect  your list if female or maleREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
switch Params.ChoiceList
case 'Males'
miceList=Params.malesList;
miceList=strrep(miceList,'''',''); %for removing double quotes
miceListRibs=Params.malesListRibs;
miceListRibs=strrep(miceListRibs,'''','');
miceListRibsSecond=Params.malesListRibsSecond; %in the case a third chip was implanted

if isempty(find(isnan([miceListRibsSecond{1:end}])==1))
miceListRibsSecond=strrep(miceListRibsSecond,'''','');
end

case 'Females'
miceList=Params.femalesList;
miceList=strrep(miceList,'''',''); %for removing double quotes
miceListRibs=Params.femalesListRibs;
miceListRibs=strrep(miceListRibs,'''','');
miceListRibsSecond=Params.femalesListRibsSecond;%in the case a third chip was implanted

if isempty(find(isnan([miceListRibsSecond{1:end}])==1))
miceListRibsSecond=strrep(miceListRibsSecond,'''','');
end

end

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDefine object IsSleepingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
IsSleepingobj=Sleeping; %use class Sleeping
IsSleepingobj.AntennaCage=Params.AntennaCage; %number of antenna that detetect outside the arena
IsSleepingobj.AntennaSideBox=Params.SideBoxAntenna;%number of antenna in the side box
IsSleepingobj.SleepingCoord=Params.Coordinates.CoordSleepingCells; %coordinates of the sleeping cells if it is right or left
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDefine object IsHidingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
IsHidingobj=Hiding; %use class Hiding
IsHidingobj.AntennaHidingBox=Params.AntennaHidingBox;
IsHidingobj.HidingCoord=Params.Coordinates.HidingCoordinates; %every 4rows is a different hiding box

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Define object IsArena REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
InArenaobj=Arena;
InArenaobj. AntennaCoord=Params. AntennaCoord;%antenna position
InArenaobj.TreshWalk=Params.TreshWalk;%walking threshold
InArenaobj.TreshRun=Params.TreshRun;%running threshold
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Define object TimeREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
Timeobj=TimeLine;
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDefine object IsEatingDrinkingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
IsEatingDrinkingobj=IsEatingDrinking;
IsEatingDrinkingobj.VelocityThreshFood=Params.VelocityThreshFood; %velocity when is either eating or drinking
IsEatingDrinkingobj.FoodCoordinates=Params.Coordinates.FoodCoordinates;%coordinates of eating
IsEatingDrinkingobj.WaterCoordinates=Params.Coordinates.WaterCoordinates;%coordinates of drinking
IsEatingDrinkingobj.radiusD=Params.radiusD; %radius around drinking
%% 
%%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Define object IsInZoneREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
IsInZoneobj=IsInZone;
IsInZoneobj.ZoneCoord=Params.ZoneCoord;


%%
%%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-SELECT BETWEEN DOING ALL THE EXPERIMENT OR THE SELECTION OF SOME
%%FILESREPLACE_WITH_DASH_DASH-

switch Params.ForSomeFile
case 0 %All the experiment
nCSV=CSVobj.NumFiles(CSVobj.ListFiles);  %number of files of all the experiment   

for i=1:nCSV %loop over the original files

%% Variables 
    
clear ArrayX; %for x coord.
clear ArrayY; %for y coord.
clear ArrayXY;
ArrayX=[];
ArrayY=[];
ArrayXY=[];
clear Distance;
clear  VectorX;
clear  VectorY;
clear  VectorX1;
clear  VectorY1;
Distance=[];
VectorX=[];
VectorY=[];   
VectorX1=[];
VectorY1=[];
clear MouseArray;
%% Read excel and matlab files for each nCSV
        
CSVFile=CSVobj.ReadFilesAllCSV(CSVobj.ListFiles,i);%read each file
CSVmiceIDs=CSVobj.miceIDs(CSVobj.ListFiles,i);%read the mice identities of each file-Now the  order of the mice identity is the same for each file
CSVFileName=CSVobj.FileName(CSVobj.ListFiles,i);

% Read the mat file


MatFileName=strcat(CSVFileName(1:strfind(CSVFileName,']')),'.mat');

load(MatFileName); %the structure is lococomotion

%% 


 hn=msgbox(strcat('Doing File:',num2str(i)))

% %% %%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH According to date select RFDIREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% ListFiles=CSVobj.ListFiles;
% ListFiles(i).name
%  IndexFilesDates=findRFIDSubset(ListFiles(i).name,DateFiles);
% 
%  SelectedDataRFID=RFIDobj.ReadFilesAllDate(RFIDobj.ListFiles,IndexFilesDates);

%% Create a wait bar for control
hbar = waitbar(0,'Please wait...'); 

% Rearrange the data according to the mice in a multidimensional array

for j=1:length(miceList) %for each mouse
      %% Clear the variables
    clear AuxID
    clear Auxtime
    clear Auxantenna
    clear Iaux
    clear AuxIDn
    clear Auxtimen
    clear Auxantennan
    %% 

%ONLY CONSIDER THE LAST NUMBERS SINCE SOMETIMES THE INITIAL ZERO DISSAPEAR

Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,'UniformOutput', false);

MouseArray(2:length([CSVFile{1}])+1,1,j)=CSVFile{1}; %for date
MouseArray(2:length([CSVFile{2}])+1,2,j)=strcat('''',[CSVFile{2}],''''); %for time

if ~isempty(find(cell2mat(Ind)==1))
    %% 
MouseArray(2:length([CSVFile{2}])+1,3,j)=num2cell(CSVFile{3+(find(cell2mat(Ind)==1)-1)*3}); %for x
MouseArray(2:length([CSVFile{2}])+1,4,j)=num2cell(CSVFile{4+(find(cell2mat(Ind)==1)-1)*3}); %for y

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHFound in the RFID selected data the mouse with 2 identities head or reabsREPLACE_WITH_DASH_DASH
%%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCouple RFID with original timeREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH


AuxID=vertcat(SelectedDataRFID{:,1});%identity
Auxtime=vertcat(SelectedDataRFID{:,3}); %time
Auxantenna=vertcat(SelectedDataRFID{:,4}); %antenna

if ~isempty(find(isnan([miceListRibsSecond{1:end}])==1))%for 2 chips
Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1)]; %find the identity of the respective mouse either with the ribs or head ID

else %for 3 chips
 Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1);find(strcmp(miceListRibsSecond(j),AuxID)==1)]; %find the identity of the respective mouse either with the chips on the ribs int 2 places or head ID   

end


%for the specific mouse
 AuxIDn=AuxID(Iaux);
 Auxtimen=Auxtime(Iaux);
 Auxantennan=Auxantenna(Iaux);
 
  %search the similar time points for each frame in the csv file
  d=knnsearch(datenum(Auxtimen,'HH:MM:SS.FFF'),datenum(CSVFile{2},'HH:MM:SS.FFF'));


   %save rfid data in a mouse array  
    MouseArray(2:length([CSVFile{2}])+1,5,j)=strcat('''',Auxtimen(d),''''); %RFID time
    MouseArray(2:length([CSVFile{2}])+1,6,j)=Auxantennan(d); %antenna rfid

     %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Treat with the timeREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    Timeobj.FrameTime=[CSVFile{2}];
    Timeobj.RFIDTime=Auxtimen(d);
    
    DeltaTimeFrameRFID=abs(Timeobj.DeltaTime)*1000 ;%for getting in msREPLACE_WITH_DASH_DASH difference between rfid and the frame time
    MouseArray(2:length([CSVFile{2}])+1,22,j)=num2cell(DeltaTimeFrameRFID);
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHdefine time object for sleepingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    IsSleepingobj.TimeLapseFrameAntenna=DeltaTimeFrameRFID;
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHdo frame time differenceREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    FrameTimeDif=abs(Timeobj.FrameTimeDif)*1000; %for getting in ms-difference with the same frame
     MouseArray(2:length([CSVFile{2}])+1,23,j)=num2cell(FrameTimeDif);

    %% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena
      if i==1
        I=[];
        if cell2mat(MouseArray(1,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,'first');
        MouseArray(1:I-1,6,j)={''};   
        end
        
    end

    %% 
  MouseArray(2:length([CSVFile{2}])+1,7,j)=AuxIDn(d); %mouse id

  %%  %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHFind is sleepingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
      IsSleepingobj.CoordinateX=MouseArray(:,3,j);
      IsSleepingobj.CoordinateY=MouseArray(:,4,j);
      IsSleepingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,8,j)=num2cell(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping));
      
     SleepingInterval=IsSleepingobj.IsSleepingInterval(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping)); %sleeping interval
     SleepingBeg= SleepingInterval(:,1);
     SleepingEnd=SleepingInterval(:,2);
     MouseArray(2:length(SleepingBeg)+1,17,j)=num2cell(SleepingBeg);
     MouseArray(2:length(SleepingEnd)+1,18,j)=num2cell(SleepingEnd);
     
     
     %find the number of the sleeping cage
     MouseArray(2:length([CSVFile{2}])+1,9,j)=num2cell(IsSleepingobj.IsSleepingCage(SleepingInterval));
     
     %arrange coordinates for sleeping
     MouseArray(2:length([CSVFile{2}])+1,13:14,j)=num2cell(IsSleepingobj.IsSleepingCoord(SleepingInterval,IsSleepingobj.IsSleepingCage(SleepingInterval)));
     %% 
       %%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Find is hidingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH 
      IsHidingobj.CoordinateX=MouseArray(:,13,j);%use the coordinates after the correction of sleeping
      IsHidingobj.CoordinateY=MouseArray(:,14,j);
      IsHidingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,10,j)=num2cell(IsHidingobj.IsHiding);     
       
       %find hiding interval
       
     HidingInterval=IsHidingobj.IsHidingInterval(IsHidingobj.IsHiding); %sleeping interval
     HidingBeg= HidingInterval(:,1);
     HidingEnd=HidingInterval(:,2);
     MouseArray(2:length(HidingBeg)+1,19,j)=num2cell(HidingBeg);
     MouseArray(2:length(HidingEnd)+1,20,j)=num2cell(HidingEnd);
       
     %find the number of the hiding box
     MouseArray(2:length([CSVFile{2}])+1,11,j)=num2cell(IsHidingobj.IsHidingCage(HidingInterval));  
       
      %arrange coordinates for hiding
     MouseArray(2:length([CSVFile{2}])+1,15:16,j)=num2cell(IsHidingobj.IsHidingCoord(HidingInterval,IsHidingobj.IsHidingCage(HidingInterval))); 
     %% %% 
     %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Find is in the arenaREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    %find the interval for in arena
     InArenaobj.IsSleeping=MouseArray(:,8,j);
     InArenaobj.IsHiding=MouseArray(:,10,j);
     InArenaobj.AntennaNumber=Auxantennan(d);
     
     MouseArray(2:length([CSVFile{2}])+1,12,j)=num2cell(InArenaobj.InArena);  
    
     %% Addition number of frame
     MouseArray(2:length([CSVFile{2}])+1,21,j)=num2cell([0:length([CSVFile{2}])-1]');
    
     %% 
    if i==1 %for the first csv file
        I=[];
        if cell2mat(MouseArray(2,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(2:length([CSVFile{2}])+1,3,j))~=1e6,1,'first');
        MouseArray(2:I-1,12,j)=num2cell(0);   
        end
        
    end
else %if the mouse doesn't exit
%   MouseArray(:,3,j)={''};
 MouseArray(2:length([CSVFile{2}])+1,3:21,j)=num2cell([0]);
end 
% 
% 
%% 
%%Coordinates after sleeping and hiding

   ArrayX=[ArrayX,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15,j))];
   ArrayY=[ArrayY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,16,j))];
   ArrayXY=[ArrayXY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15:16,j))]; 
%% 

 %Control of wait bar
 waitbar(j/length(miceList));

end
%NOTE:DECIDE IF TO SAVE THE MOUSE ARRAY MATRIX

% Results.miceList=miceList;
% Results.MouseArray=MouseArray;
%  %save(mat according the date)
 close(hbar)
 
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Treat spetial casesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Find repeated Frames for further useREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
  RepeatedFrames=CSVobj.RemoveDuplicFrame(ArrayXY);
 
 %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHIdentified in the arena duplicates and no video REPLACE_WITH_DASH_DASH-

hbar=waitbar(0,'Second part wait')

for j=1:length(miceList)
    clear InArenaNonDefined;
    clear InArenaDuplicates;
   Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,'UniformOutput', false);
    
    if ~isempty(find(cell2mat(Ind)==1))
      if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))     
         InArenaNonDefined=InArenaobj.InArenaNonDefined(ArrayX,ArrayY,j,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
         InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length(miceList),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
         MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(InArenaDuplicates);
         MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);
      else
          MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(0);%for cases it is inside the cage all along the file
          MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(0); 
      end    
      %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Calculate velocity REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
   if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))    
       InArenaVelocity=InArenaobj.InArenaVelocity(RepeatedFrames,ArrayX(:,j),ArrayY(:,j), (cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j))));
       MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(InArenaVelocity); 
   else
      MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(0); %for cases it is inside the cage all along the file  
   end    
     %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Calculate distance to antennaREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
     InArenaAntennaDistance=InArenaobj.InArenaAntennaDistance(ArrayX(:,j),ArrayY(:,j),InArenaDuplicates,MouseArray(2:length([CSVFile{2}])+1,6,j));
     MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell( InArenaAntennaDistance); 
    else
     MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell(0); %for cases it is inside the cage all along the file      
    end    
     
     
       %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCorrect the coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
   if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))  
        InArenaCorrectedCoord=InArenaobj.InArenaCorrectedCoord(ArrayX(:,j),ArrayY(:,j),RepeatedFrames, InArenaAntennaDistance,InArenaDuplicates,InArenaNonDefined,cell2mat(MouseArray(2:length([CSVFile{2}])+1,22,j)),MouseArray(2:length([CSVFile{2}])+1,6,j));
        MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedCoord(:,1));
        MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedCoord(:,2));
   else
        MouseArray(2:length([CSVFile{2}])+1,28,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
        MouseArray(2:length([CSVFile{2}])+1,29,j)=MouseArray(2:length([CSVFile{2}])+1,16,j);%for cases it is inside the cage all along the file
   end    
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Interpolate the coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
        TimeFrame=cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j));
        if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
            try %in the case the interpolation is not working  giving error returned old coordinates
             InArenaInterpolation=InArenaobj.InArenaInterpolation(RepeatedFrames,TimeFrame,InArenaCorrectedCoord(:,1),InArenaCorrectedCoord(:,2));
    
           MouseArray(2:length([CSVFile{2}])+1,30,j)=num2cell(InArenaInterpolation(:,1));
           MouseArray(2:length([CSVFile{2}])+1,31,j)=num2cell(InArenaInterpolation(:,2));
           
            catch
               MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
              MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); 
                
            end
           
        else   
            MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
            MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); %for cases it is inside the cage all along the file
           
        end  
        %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Return repeated coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
        if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) %verify that part of the time is in the arena - there csv files where the mouse was all time in the cage
             InArenaAddRepeats=InArenaobj.InArenaAddRepeats(RepeatedFrames,InArenaInterpolation(:,1),InArenaInterpolation(:,2));
             MouseArray(2:length([CSVFile{2}])+1,32,j)=num2cell(InArenaAddRepeats(:,1));
             MouseArray(2:length([CSVFile{2}])+1,33,j)=num2cell(InArenaAddRepeats(:,2));
        else 
             MouseArray(2:length([CSVFile{2}])+1,32,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
             MouseArray(2:length([CSVFile{2}])+1,33,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); %for cases it is inside the cage all along the file
        end
        
        % In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena
      if i==1
        I=[];
        if cell2mat(MouseArray(1,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,'first');
        MouseArray(1:I-1,32,j)={''};   
        MouseArray(1:I-1,33,j)={''}; 
        end
        
    end
   
        
        
        
        
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-In Arena velocity with approximate real time REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    RealTime=78; %Real time is 78ms
    if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
         InArenaVelocityR=InArenaobj.InArenaVelocityR(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2),RealTime,cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j)));
         MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(InArenaVelocityR); 
    else
        MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(0);%for cases it is inside the cage all along the file
    end   
    
  
    
    
     %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHEXCEPTIONS: The antenna position didn't correct the non-defined positions thus assign incorrect valueREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    clear Iexception1
    clear Iexception2
    
    %Consider the cases which are in the arena , not defined (1e6 coord
    %value) and negative or very big coordinates either x or y.Then in
    %arena is zero (we cannot say nothing
    Iexception1=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)))>2000 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    Iexception2=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)))>2000 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    
    if ~isempty(find(Iexception1==1))
        MouseArray(Iexception1,12,j)=num2cell([0]);
    elseif ~isempty(find(Iexception2==1))
        MouseArray(Iexception2,12,j)=num2cell([0]);
        
    end
    
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
     
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDetermine when it is stop,running, walking according to the velocityREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH  
   
     InArenaVelocityRInterp=InArenaobj.InArenaVelocityRInterp(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));      
           
%      InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
    %InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)));
    
   InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,InArenaVelocityRInterp,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
    
    MouseArray(2:length([CSVFile{2}])+1,35,j)=num2cell(InArenaVelocityRInterp(:,1));%add to velocity interpolation where the velocity is zero
    MouseArray(2:length([CSVFile{2}])+1,36,j)=num2cell(InArenaActivity(:,1)); %stop
    MouseArray(2:length([CSVFile{2}])+1,37,j)=num2cell(InArenaActivity(:,2));%walking
    MouseArray(2:length([CSVFile{2}])+1,38,j)=num2cell(InArenaActivity(:,3));%running
       
    
    
   %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- 
   %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDetermine if it is drinking or eatingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
   %First complete in all the repeated frames the velocities 
   clear InArenaVelocityAllFrames;
 
   
   InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,InArenaVelocityRInterp);
   
     IsEating=IsEatingDrinkingobj. IsEating(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);
     IsDrinking=IsEatingDrinkingobj. IsDrinking(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames); 
    
    MouseArray(2:length([CSVFile{2}])+1,39,j)=num2cell(IsEating);%eating
    MouseArray(2:length([CSVFile{2}])+1,40,j)=num2cell(IsDrinking);%drinking
    
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Determine if it is inside or outside a given zoneREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
  
    IsZone=IsInZoneobj.IsZone(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)));
  
    MouseArray(2:length([CSVFile{2}])+1,41,j)=num2cell(IsZone(:,1));%inner zone
    MouseArray(2:length([CSVFile{2}])+1,42,j)=num2cell(IsZone(:,2));%outside zone
   
     %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-for further use create 2 auxiliary arraysREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH 
    
    
   if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
       InArenaAuxiliary=InArenaobj.InArenaAuxiliary(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2));
       Distance(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,1);
       VectorX(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,2); %normalized vector
       VectorY(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,3); %normalized vector
       
       VectorX1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,4); %not normalized vector
       VectorY1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,5); %not normalized vector
    else
           Distance(1:length(RepeatedFrames)-1,j)=0; %in the case it is inside all the time
           VectorX(1:length(RepeatedFrames)-1,j)=0;
           VectorY(1:length(RepeatedFrames)-1,j)=0;
          VectorX1(1:length(RepeatedFrames)-1,j)=0;
           VectorY1(1:length(RepeatedFrames)-1,j)=0; 
    end
    %% 
    
    else %if the mouse doesn't exit
 MouseArray(2:length([CSVFile{2}])+1,3:42,j)=num2cell([0]);
 
end 
% 
 
     waitbar(j/length(miceList));
      
end
 close(hbar)
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Save the locomotion parameters as a structure bring  all the mice togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
Locomotion.miceList=miceList;
Large=length(MouseArray(:,12,1));
Locomotion.isInArena=reshape(cell2mat(MouseArray(2:Large,12,:)),Large-1,length(miceList));
Locomotion.TrajectoryX=reshape(cell2mat(MouseArray(2:Large,32,:)),Large-1,length(miceList)); %coord after corrections with repeats
Locomotion.TrajectoryY=reshape(cell2mat(MouseArray(2:Large,33,:)),Large-1,length(miceList));  %coord after corrections with repeats
% Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,34,:)),Large-1,length(miceList)); %velocity of the real frames
Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,35,:)),Large-1,length(miceList)); %velocity of the real frames by including interpolation of zero velocity points inside the arena
Locomotion.InArenaDuplicates=reshape(cell2mat(MouseArray(2:Large,24,:)),Large-1,length(miceList)); %In arena duplicates
Locomotion.RepeatedFrames=RepeatedFrames;
Locomotion.ExperimentalTime=MouseArray(2:Large,2,1); %take only one mouse since it is the same time for everything.
Locomotion.VectorX=VectorX; %without repeats
Locomotion.VectorY=VectorY; %without repeats
Locomotion.Distance=Distance;%without repeats
Locomotion.VectorX1=VectorX1; %without repeats no normalized
Locomotion.VectorY1=VectorY1; %no normalized
Locomotion.isStop=reshape(cell2mat(MouseArray(2:Large,36,:)),Large-1,length(miceList));
Locomotion.isWalking=reshape(cell2mat(MouseArray(2:Large,37,:)),Large-1,length(miceList));
Locomotion.isRunning=reshape(cell2mat(MouseArray(2:Large,38,:)),Large-1,length(miceList));
Locomotion.IsEating=reshape(cell2mat(MouseArray(2:Large,39,:)),Large-1,length(miceList));
Locomotion.IsDrinking=reshape(cell2mat(MouseArray(2:Large,40,:)),Large-1,length(miceList));
Locomotion.IsSleeping=reshape(cell2mat(MouseArray(2:Large,8,:)),Large-1,length(miceList));
Locomotion.IsHiding=reshape(cell2mat(MouseArray(2:Large,10,:)),Large-1,length(miceList));
Locomotion.SleepingBox=reshape(cell2mat(MouseArray(2:Large,9,:)),Large-1,length(miceList));
Locomotion.HidingBox=reshape(cell2mat(MouseArray(2:Large,11,:)),Large-1,length(miceList));
Locomotion.IsInsideZone=reshape(cell2mat(MouseArray(2:Large,41,:)),Large-1,length(miceList));
Locomotion.IsOutsideZone=reshape(cell2mat(MouseArray(2:Large,42,:)),Large-1,length(miceList));


%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCompute distance pairsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
 DistancePairs=computeDistancePairsGV(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.IsHiding,Locomotion.RepeatedFrames);
Locomotion.DistancePairs=DistancePairs;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Compute togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Define object togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
Togetherobj=Together;
Togetherobj.DistanceToBeTogether=Params.DistanceToBeTogheter; %distance to be considered together in general is 10cm
Togetherobj.numOfMice=length(Locomotion.miceList);

TogetherCalc=Togetherobj.TogetherCalc(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.RepeatedFrames);
Locomotion.TimesTogether=TogetherCalc(1,length(Locomotion.miceList)+1);
Locomotion.TogetherAll=TogetherCalc(1,1:length(Locomotion.miceList));



%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Calculating chasingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Create chasing objectREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%All the units are in mm
Chasingobj=Chasing;
Chasingobj.numOfMice=length(Locomotion.miceList);
Chasingobj.Dist_tresh1=300;
Chasingobj.Velocity_Tresh=0.5;
Chasingobj.PathTresh=600;
Chasingobj.Dist_tresh2=200;
% 
Chasingobj.AngleMaximum1=Params.AngleMaximum1; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.
Chasingobj.AngleMaximum2=Params.AngleMaximum2; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.
Chasingobj.MinimumPath=Params.editpar1; %This is the minimum path recording to be considered as chasing.
Chasingobj.GapPath=Params.editpar2; %This is the maximum distance allow to finish the chasing mm
Chasingobj.ThreshVelocity=Params.editpar3; %20-10 cm/sec
Chasingobj.GapFrames=Params.editpar4; %maximum number of frames to be allowed to be a gap
Chasingobj.GapPathEnd=Params.editpar5; %the end of the frame

Chasingobj.GapFramesS=Params.editpar6; %maximum number of frames to be allowed to be a gap in small frames
Chasingobj.GapPathEndS=Params.editpar7; % condition of the end of the frame in small frames

% Chasingobj.AngleMaximum1=20; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.
% Chasingobj.AngleMaximum2=20; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.
% Chasingobj.MinimumPath=200; %This is the minimum path recording to be considered as chasing.
% Chasingobj.GapPath=400; %This is the maximum distance allow to finish the chasing mm
% Chasingobj.ThreshVelocity=10; %20-10 cm/sec
% Chasingobj.GapFrames=100; %maximum number of frames to be allowed to be a gap
% Chasingobj.GapPathEnd=200; %the end of the frame






%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

TrajectoryX=Locomotion.TrajectoryX(Locomotion.RepeatedFrames,:);
TrajectoryY=Locomotion.TrajectoryY(Locomotion.RepeatedFrames,:);
Velocity=Locomotion.Velocity(Locomotion.RepeatedFrames,:);
%% CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO GV MODULE

% ChasingCal=Chasingobj.ChasingCal(TrajectoryX,TrajectoryY,Locomotion.Velocity(Locomotion.RepeatedFrames,:),Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.VectorX,Locomotion.VectorY,Locomotion.Distance,Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:));

%% CALCULATION OF CHASING BY INSERTING CORRECTED COORDINATES INTO SILVIA MODULE
 ChasingCalvs2=Chasingobj.ChasingCalvs2(TrajectoryX,TrajectoryY,Locomotion.VectorX1,Locomotion.VectorY1,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Velocity,Locomotion.InArenaDuplicates(Locomotion.RepeatedFrames,:) );

%% 

% Locomotion.ChasingAll=ChasingCal(:,1:Chasingobj.numOfMice);
% Locomotion.ChasedAll=ChasingCal(:,Chasingobj.numOfMice+1:2*Chasingobj.numOfMice);

% Locomotion.MoveTogether=ChasingCal(:,2*Chasingobj.numOfMice+1:3*Chasingobj.numOfMice);


Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);
Locomotion.BeingChasingAll=ChasingCalvs2(:,Chasingobj.numOfMice+1:Chasingobj.numOfMice+Chasingobj.numOfMice);
Locomotion.TimeWithoutRepeats=Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:);



hhh=msgbox('Chasing analysis finish')
close(hhh)
%%                                                  CALCULATION OF AVOIDANCE(mouse2 near mouse1 but mouse1 running away from mouse2)

% Create Avoidance object
Avoidanceobj=Avoidance;
Avoidanceobj.numOfMice=length(Locomotion.miceList);
Avoidanceobj.Distance_thresh= Params.Distance_thresh_For_Avoidance;
Avoidanceobj.Dist_thresh_Fine_Tuning=Params.Dist_thresh_Fine_Tuning_For_Avoidance; %dist for fine tuning according GV is 100mm
Avoidanceobj.velThr=Params.Velocity_For_Avoidance;% according gv 35cm/sec
Avoidanceobj.R=Params.Radius_Within_Avoidance;% according gv 30 cm

%% 
AvoidanceCal=Avoidanceobj.AvoidanceCal(TrajectoryX,TrajectoryY,Velocity,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames)
%% 
Locomotion.avoiding=AvoidanceCal;

hhhh=msgbox('Avoidance calculation was finished')
close(hhhh)

%% %%                                                  CALCULATION OF APPROACHING (mouse 1 approaches mouse 2 and the event finished)

% Create Approaching object
 Approachingobj=Approaching;
 Approachingobj.numOfMice=length(Locomotion.miceList);
 Approachingobj.Distance_thresh= Params.Distance_thresh_For_Approaching; %According to GV this is 40cm
 Approachingobj.distTr=Params.Distance_Thresh_For_Approaching_Fine_Tuning;%According to GV this is 10cm
 Approachingobj.CorrelFactor=Params.CorrFactor_between_mice_For_Approaching; %According to GV this is 0.3
 Approachingobj.velTr2=Params.Velocity_Thresh_To_beSamePlace_For_Approaching; %According to GV this is 25cm/sec


%% 
ApproachingCal=Approachingobj.ApproachingCal(TrajectoryX,TrajectoryY,Velocity,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Locomotion.VectorX,Locomotion.VectorY)
% %% 
Locomotion.ApproachingAll=ApproachingCal(:,1:Approachingobj.numOfMice);
Locomotion.BeingApproachingAll=ApproachingCal(:,Approachingobj.numOfMice+1:Approachingobj.numOfMice+Approachingobj.numOfMice);

hhhh=msgbox('Approaching calculation was finished')
close(hhhh)


%% %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHSave as a mat fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
Namef=char(ListFiles(i).name);
filename1=strcat(Namef(1:end-4),'.mat');

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Change the format of the time as GVREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

Indexes=strfind(filename1,'-'); %the first one gives the date

date1=strrep(filename1(1:Indexes(1)-1),'.','_');

Indexes1a=strfind(filename1,'['); %the initial time
Indexes1b=strfind(filename1,']'); %the final time

time1=filename1(Indexes1a+1:Indexes1b-1);
Indexes2=strfind(time1,'.');
time1([Indexes2(1),Indexes2(2),Indexes2(4),Indexes2(5)])='_';
filename1=strcat(date1,'_',time1,'.mat');
%% 

mkdir(Params.resultsDir);
filename1=strcat(Params.resultsDir,'\',filename1);%where are the matlab results

save(filename1,'Locomotion');

%% 

 

 close(hn)
 %% 
 
end

%% %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Arrange the chasing events into an excel file AGREGAR LO QUE FALTAREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
[AllChasing,AllAvoiding,AllApproaching]=GetEvents;
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHSAVE SOCIAL EVENTS INTO EXCEL FILEREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
behaviour=0;

for behaviour=1:3
  switch(behaviour)
    case 1    %for chasing
        if ~isempty(AllChasing)
          SaveSocialData(AllChasing,behaviour,Params.SaveDirectory,Params.exp_name,Chasingobj)
        end
    case 2  %for avoiding
          if ~isempty(AllAvoiding)
          SaveSocialData(AllAvoiding,behaviour,Params.SaveDirectory,Params.exp_name,Avoidanceobj)
        end
    case 3  %for approaching
          if ~isempty(AllApproaching)
          SaveSocialData(AllApproaching,behaviour,Params.SaveDirectory,Params.exp_name,Approachingobj)
        end
 end
end          
          
          
  msgbox('Finish all')

%%
%END MULTIPLE FILES
%%BEGIN FOR SELECTED FILES 
%% 
%% 

case 1 %take single files from the list for further analysis
    
index_selected = get(h.listAllRFID,'Value');  %Select the csv files to work
list = cellstr(get(h.listAllRFID,'String'));
item_selected = list(index_selected,1); % Convert from cell array to string
nCSV=length(item_selected);

for i=1:nCSV %loop over the original files
clear ArrayX; %for x coord.
clear ArrayY; %for y coord.
clear ArrayXY;
clear ArrayRFID;

ArrayX=[];
ArrayY=[];
ArrayXY=[];
ArrayRFID=[];

 clear Distance;
  clear  VectorX;
  clear  VectorY;
    clear  VectorX1;
  clear  VectorY1;
Distance=[];
VectorX=[];
VectorY=[];   
VectorX1=[];
VectorY1=[]; 
    
    
    
clear MouseArray ;  
CSVFile=CSVobj.ReadFilesAllCSV(CSVobj.ListFiles,index_selected(i));%Use Files Treat to read this file
CSVmiceIDs=CSVobj.miceIDs(CSVobj.ListFiles,index_selected(i));

%%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH According to date select RFDIREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
 IndexFilesDates=findRFIDSubset(item_selected(i),DateFiles);

SelectedDataRFID=RFIDobj.ReadFilesAllDate(RFIDobj.ListFiles,IndexFilesDates);

%% Create a wait bar for control
hbar = waitbar(0,'Please wait...');

% Rearrange the data according to the mice in a multidimensional array

for j=1:length(miceList) %for each mouse
    %% Clear the variables
    clear AuxID
    clear Auxtime
    clear Auxantenna
    clear Iaux
    clear AuxIDn
    clear Auxtimen
    clear Auxantennan
    
    %% 

%ONLY CONSIDER THE LAST NUMBERS SINCE SOMETIMES THE INITIAL ZERO DISSAPEAR

Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,'UniformOutput', false);

MouseArray(2:length([CSVFile{1}])+1,1,j)=CSVFile{1}; %for date
MouseArray(2:length([CSVFile{2}])+1,2,j)=strcat('''',[CSVFile{2}],''''); %for time

if ~isempty(find(cell2mat(Ind)==1))
MouseArray(2:length([CSVFile{2}])+1,3,j)=num2cell(CSVFile{3+(find(cell2mat(Ind)==1)-1)*3}); %for x
MouseArray(2:length([CSVFile{2}])+1,4,j)=num2cell(CSVFile{4+(find(cell2mat(Ind)==1)-1)*3}); %for y

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHFound in the RFID selected data the mouse with 2 identitiesREPLACE_WITH_DASH_DASH
AuxID=vertcat(SelectedDataRFID{:,1});%identity
Auxtime=vertcat(SelectedDataRFID{:,3}); %time
Auxantenna=vertcat(SelectedDataRFID{:,4}); %antenna
Iaux=[find(strcmp(miceList(j),AuxID)==1); find(strcmp(miceListRibs(j),AuxID)==1)]; %find the identity of the respective mouse either with the ribs or head ID

%for the specific mouse
 AuxIDn=AuxID(Iaux);
 Auxtimen=Auxtime(Iaux);
 Auxantennan=Auxantenna(Iaux);
 
 %search the similar time points for each frame in the csv file
  d=knnsearch(datenum(Auxtimen,'HH:MM:SS.FFF'),datenum(CSVFile{2},'HH:MM:SS.FFF'));
  
  %save rfid data in a mouse array  
    MouseArray(2:length([CSVFile{2}])+1,5,j)=strcat('''',Auxtimen(d),''''); %RFID time
    MouseArray(2:length([CSVFile{2}])+1,6,j)=Auxantennan(d); %antenna rfid
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Treat with the timeREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    Timeobj.FrameTime=[CSVFile{2}];
    Timeobj.RFIDTime=Auxtimen(d);
    
    DeltaTimeFrameRFID=abs(Timeobj.DeltaTime)*1000 ;%for getting in ms
    MouseArray(2:length([CSVFile{2}])+1,22,j)=num2cell(DeltaTimeFrameRFID);
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHdefine time object for sleepingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    IsSleepingobj.TimeLapseFrameAntenna=DeltaTimeFrameRFID;
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHdo frame time differenceREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    FrameTimeDif=abs(Timeobj.FrameTimeDif)*1000; %for getting in ms
     MouseArray(2:length([CSVFile{2}])+1,23,j)=num2cell(FrameTimeDif);
    
    
    %% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena
    if index_selected==1
        I=[];
        if cell2mat(MouseArray(1,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,'first');
        MouseArray(1:I-1,6,j)={''};   
        end
        
    end
    
    %% 
    
    
    MouseArray(2:length([CSVFile{2}])+1,7,j)=AuxIDn(d); %mouse id
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHFind is sleepingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
      IsSleepingobj.CoordinateX=MouseArray(:,3,j);
      IsSleepingobj.CoordinateY=MouseArray(:,4,j);
      IsSleepingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,8,j)=num2cell(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping));
      
     SleepingInterval=IsSleepingobj.IsSleepingInterval(IsSleepingobj.IsSleepingCorrections(IsSleepingobj.IsSleeping)); %sleeping interval
     SleepingBeg= SleepingInterval(:,1);
     SleepingEnd=SleepingInterval(:,2);
     MouseArray(2:length(SleepingBeg)+1,17,j)=num2cell(SleepingBeg);
     MouseArray(2:length(SleepingEnd)+1,18,j)=num2cell(SleepingEnd);
     
     
     %find the number of the sleeping cage
     MouseArray(2:length([CSVFile{2}])+1,9,j)=num2cell(IsSleepingobj.IsSleepingCage(SleepingInterval));
     
     %arrange coordinates for sleeping
     MouseArray(2:length([CSVFile{2}])+1,13:14,j)=num2cell(IsSleepingobj.IsSleepingCoord(SleepingInterval,IsSleepingobj.IsSleepingCage(SleepingInterval)));

     %% 
       %%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Find is hidingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH 
      IsHidingobj.CoordinateX=MouseArray(:,13,j);%use the coordinates after the correction of sleeping
      IsHidingobj.CoordinateY=MouseArray(:,14,j);
      IsHidingobj.AntennaNumber=Auxantennan(d);
      MouseArray(2:length([CSVFile{2}])+1,10,j)=num2cell(IsHidingobj.IsHiding);     
       
       %find hiding interval
       
     HidingInterval=IsHidingobj.IsHidingInterval(IsHidingobj.IsHiding); %sleeping interval
     HidingBeg= HidingInterval(:,1);
     HidingEnd=HidingInterval(:,2);
     MouseArray(2:length(HidingBeg)+1,19,j)=num2cell(HidingBeg);
     MouseArray(2:length(HidingEnd)+1,20,j)=num2cell(HidingEnd);
       
     %find the number of the hiding box
     MouseArray(2:length([CSVFile{2}])+1,11,j)=num2cell(IsHidingobj.IsHidingCage(HidingInterval));  
       
      %arrange coordinates for hiding
     MouseArray(2:length([CSVFile{2}])+1,15:16,j)=num2cell(IsHidingobj.IsHidingCoord(HidingInterval,IsHidingobj.IsHidingCage(HidingInterval))); 
     %% 
     %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Find is in the arenaREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
    %find the interval for in arena
     InArenaobj.IsSleeping=MouseArray(:,8,j);
     InArenaobj.IsHiding=MouseArray(:,10,j);
     InArenaobj.AntennaNumber=Auxantennan(d);
     
     MouseArray(2:length([CSVFile{2}])+1,12,j)=num2cell(InArenaobj.InArena);  
     
     
     %% Addition number of frame
     MouseArray(2:length([CSVFile{2}])+1,21,j)=num2cell([0:length([CSVFile{2}])-1]');
    
     %%     %% In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena
    if index_selected==1
        I=[];
        if cell2mat(MouseArray(2,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(2:length([CSVFile{2}])+1,3,j))~=1e6,1,'first');
        MouseArray(2:I-1,12,j)=num2cell(0);   
        end
        
    end
    
else %if the mouse doesn't exit
  %MouseArray(:,3,j)={''};
  MouseArray(:,:,j)={'0'};
end    

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Save to excel fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
% Titles

MouseArray(1,1,j)={'Experiment Date'};
MouseArray(1,2,j)={'Experiment Time'};
MouseArray(1,3,j)={'Original x coord.'};
MouseArray(1,4,j)={'Original y coord.'};
MouseArray(1,5,j)={'RFID Time'};
MouseArray(1,6,j)={'Number RFID antenna'};
MouseArray(1,7,j)={'RFID mouse identity'};
MouseArray(1,8,j)={'Is Sleeping'};
MouseArray(1,9,j)={'Sleeping Box'};
MouseArray(1,10,j)={'Is Hiding'};
MouseArray(1,11,j)={'Hiding Box'};
MouseArray(1,12,j)={'In Arena'};
MouseArray(1,13,j)={'Coord x with Sleeping'};
MouseArray(1,14,j)={'Coord y with Sleeping'};
MouseArray(1,15,j)={'Coord x with Hiding/Sleeping'};
MouseArray(1,16,j)={'Coord y with Hiding/Sleeping'};
MouseArray(1,17,j)={'Beg.Int.Sleeping'};
MouseArray(1,18,j)={'End Int.Sleeping'};
MouseArray(1,19,j)={'Beg.Int.Hiding'};
MouseArray(1,20,j)={'End.Int.Hiding'};
MouseArray(1,21,j)={'Number of video frame'};
MouseArray(1,22,j)={'Elapsed time between Frame and RFID (msec)'};
MouseArray(1,23,j)={'Elapsed time between frames (msec)'};
MouseArray(1,24,j)={'Duplicates in coord. at arena'};
MouseArray(1,25,j)={'Non defined coord. at arena'};
MouseArray(1,26,j)={'Velocity without repeats in (cm/sec)'};
MouseArray(1,27,j)={'Distance from antenna for duplicates (mm)'};
MouseArray(1,28,j)={'X corrected coord.'};
MouseArray(1,29,j)={'Y corrected coord.'};
MouseArray(1,30,j)={'X interpolated coord.'};
MouseArray(1,31,j)={'Y interpolated coord.'};
MouseArray(1,32,j)={'X interpolated coord. with repeats'};
MouseArray(1,33,j)={'Y interpolated coord. with repeats'};
MouseArray(1,34,j)={'In Arena velocity with real time between frames'};
MouseArray(1,35,j)={'In Arena velocity with real time between frames with interpol.'};
MouseArray(1,36,j)={'Is stop'};
MouseArray(1,37,j)={'Is walking'};
MouseArray(1,38,j)={'Is running'};
MouseArray(1,39,j)={'Is eating'};
MouseArray(1,40,j)={'Is drinking'};
MouseArray(1,41,j)={'Is in zone inside'};
MouseArray(1,42,j)={'Is in zone outside'};
% 
%%

   ArrayX=[ArrayX,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15,j))];
   ArrayY=[ArrayY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,16,j))];
   ArrayXY=[ArrayXY,cell2mat(MouseArray(2:length([CSVFile{2}])+1,15:16,j))];
   ArrayRFID=[ArrayRFID,(MouseArray(2:length([CSVFile{2}])+1,6,j))]; 
   
%% 

%  sheet=char(miceList(j));
%  Namef=char(item_selected(i));
%  filename=strcat(Namef(1:end-4),'LocomotionResults','.xlsx');
%  filename=strrep(filename,'[','(');
%   filename=strrep(filename,']',')');
%   filename=strcat(Params.SaveDirectory,'\',filename);
%  xlswrite(filename,MouseArray(:,:,j),sheet);

 %Control of wait bar
 waitbar(j/length(miceList));
end
close(hbar)
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Treat spetial casesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Find repeated Frames for further useREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

% RepeatedFrames=CSVobj.RemoveDuplicFrame([CSVFile{3:end}]);
  RepeatedFrames=CSVobj.RemoveDuplicFrame(ArrayXY);
 
  
  %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Add to the actual time line the missing position from the excel file fmREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
   if Params.ForMissingPosition==1 %if the csv file of missing positions is considered
%    
      clear CSVMissingFile;
      MissingWhiteobj.Number_Mouse=length(miceList);
%    
    TimeMissingFile=CSVMissingobj.ReadTimeMissingPosition(CSVobj.ListFiles,index_selected(i),length(miceList));%Read the csv file of missing positions   
    CoordMissingFile=CSVMissingobj.ReadPositionMissingPosition(CSVobj.ListFiles,index_selected(i),length(miceList)); 
%    
   Timeline=[CSVFile{2}];
%    %Add missing positions to the correct mouse
  [ArrayXMissing,ArrayYMissing]=MissingWhiteobj.FindMissingWhite(Timeline,RepeatedFrames,TimeMissingFile,CoordMissingFile(:,3:end));
%    
%    
%    
   end
  
  
  
  %% 
  
  
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHIdentified in the arena duplicates and no video REPLACE_WITH_DASH_DASH-

hbar=waitbar(0,'Second part wait')
for j=1:length(miceList)
    clear InArenaNonDefined;
    clear InArenaDuplicates;
    clear InArenaAuxiliary;
     Ind=cellfun(@(x)Find4last(x,miceList{j}(end-6:end)),CSVmiceIDs,'UniformOutput', false);
    
    if ~isempty(find(cell2mat(Ind)==1))
    
      if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
        InArenaNonDefined=InArenaobj.InArenaNonDefined(ArrayX,ArrayY,j,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length(miceList),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        %InArenaDuplicates=InArenaobj.InArenaDuplic(ArrayX,ArrayY,j,length( CSVmiceIDs),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(InArenaDuplicates);
        MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);
      else
          
        MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell(0);%for cases it is inside the cage all along the file
        MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(0); 
          
      end
    
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH Calculate velocity REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
       if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
          InArenaVelocity=InArenaobj.InArenaVelocity(RepeatedFrames,ArrayX(:,j),ArrayY(:,j), (cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j))));
          MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(InArenaVelocity); 
       else
          MouseArray(2:length([CSVFile{2}])+1,26,j)=num2cell(0); %for cases it is inside the cage all along the file
       end    
 
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Calculate distance to antennaREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
%     InArena.AntennaNumber= MouseArray(2:length([CSVFile{2}])+1,6,j);
       if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
         InArenaAntennaDistance=InArenaobj.InArenaAntennaDistance(ArrayX(:,j),ArrayY(:,j),InArenaDuplicates,MouseArray(2:length([CSVFile{2}])+1,6,j));
         MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell( InArenaAntennaDistance); 
       else
           
          MouseArray(2:length([CSVFile{2}])+1,27,j)=num2cell(0); %for cases it is inside the cage all along the file   
           
       end
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCorrect the coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
      if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
          j
          %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHAdd correction to non defined correction in the case of having the excel file with positionsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
          if Params.ForMissingPosition==1 %if the csv file of missing positions is considered
              
              
           InArenaCorrectedNonDefinedCoord=InArenaobj.InArenaCorrectedNonDefinedCoord(ArrayX(:,j),ArrayY(:,j),j,RepeatedFrames,InArenaNonDefined,ArrayRFID,ArrayXMissing,ArrayYMissing);   
              MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedNonDefinedCoord(:,1));
           MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedNonDefinedCoord(:,2));  
             InArenaNonDefined=InArenaCorrectedNonDefinedCoord(:,3); 
             MouseArray(2:length([CSVFile{2}])+1,25,j)=num2cell(InArenaNonDefined);%readjust values
             ArrayX(:,j)=InArenaCorrectedNonDefinedCoord(:,1);
             ArrayY(:,j)=InArenaCorrectedNonDefinedCoord(:,2);
          end
          
          %%   %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHAdd correction to  duplicate position with different detection antenna in the case of having the excel file with positionsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%           if Params.ForMissingPosition==1 %if the csv file of missing positions is considered
%               
%               
%            InArenaCorrectedDuplicated=InArenaobj.InArenaCorrectedNonDefinedCoord(ArrayX(:,j),ArrayY(:,j),j,RepeatedFrames,InArenaDuplicates,ArrayRFID,ArrayXMissing,ArrayYMissing);  
%            
%               MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedDuplicated(:,1));
%            MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedDuplicated(:,2));  
%              InArenaDuplicates=InArenaCorrectedDuplicated(:,3); 
%              MouseArray(2:length([CSVFile{2}])+1,24,j)=num2cell( InArenaDuplicates);%readjust values
%              ArrayX(:,j)=InArenaCorrectedDuplicated(:,1);
%              ArrayY(:,j)=InArenaCorrectedDuplicated(:,2);
%           end
          
          %% 
          
           InArenaCorrectedCoord=InArenaobj.InArenaCorrectedCoord(ArrayX(:,j),ArrayY(:,j),RepeatedFrames, InArenaAntennaDistance,InArenaDuplicates,InArenaNonDefined,cell2mat(MouseArray(2:length([CSVFile{2}])+1,22,j)),MouseArray(2:length([CSVFile{2}])+1,6,j));
           MouseArray(2:length([CSVFile{2}])+1,28,j)=num2cell(InArenaCorrectedCoord(:,1));
           MouseArray(2:length([CSVFile{2}])+1,29,j)=num2cell(InArenaCorrectedCoord(:,2));
      else
           MouseArray(2:length([CSVFile{2}])+1,28,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
           MouseArray(2:length([CSVFile{2}])+1,29,j)=MouseArray(2:length([CSVFile{2}])+1,16,j);%for cases it is inside the cage all along the file
      end
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Interpolate the coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
        TimeFrame=cell2mat(MouseArray(2:length([CSVFile{2}])+1,23,j));
        if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
          InArenaInterpolation=InArenaobj.InArenaInterpolation(RepeatedFrames,TimeFrame,InArenaCorrectedCoord(:,1),InArenaCorrectedCoord(:,2));
          MouseArray(2:length([CSVFile{2}])+1,30,j)=num2cell(InArenaInterpolation(:,1));
          MouseArray(2:length([CSVFile{2}])+1,31,j)=num2cell(InArenaInterpolation(:,2));
        else 
           MouseArray(2:length([CSVFile{2}])+1,30,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
           MouseArray(2:length([CSVFile{2}])+1,31,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); %for cases it is inside the cage all along the file
        end


%for eliminate interpolation
% 
%            MouseArray(2:length([CSVFile{2}])+1,30,j)= MouseArray(2:length([CSVFile{2}])+1,28,j);
%            MouseArray(2:length([CSVFile{2}])+1,31,j)= MouseArray(2:length([CSVFile{2}])+1,29,j);
%            InArenaInterpolation(:,1)=InArenaCorrectedCoord(:,1);
%            InArenaInterpolation(:,2)=InArenaCorrectedCoord(:,2);




        %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Return repeated coordinatesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
        if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1))
            InArenaAddRepeats=InArenaobj.InArenaAddRepeats(RepeatedFrames,InArenaInterpolation(:,1),InArenaInterpolation(:,2));
            MouseArray(2:length([CSVFile{2}])+1,32,j)=num2cell(InArenaAddRepeats(:,1));
            MouseArray(2:length([CSVFile{2}])+1,33,j)=num2cell(InArenaAddRepeats(:,2));
        else
             MouseArray(2:length([CSVFile{2}])+1,32,j)=MouseArray(2:length([CSVFile{2}])+1,15,j);
             MouseArray(2:length([CSVFile{2}])+1,33,j)=MouseArray(2:length([CSVFile{2}])+1,16,j); %for cases it is inside the cage all along the file
        end  
        
              % In the case is the first csv experiment don't consider the first 10000 data since this is the phase the mice are putting in the arena
     if i==1
       I=[];
        if cell2mat(MouseArray(1,3,j))==1e6 %only if the first is million
        I=find(cell2mat(MouseArray(:,3,j))~=1e6,1,'first');
        MouseArray(1:I-1,32,j)={''};   
        MouseArray(1:I-1,33,j)={''}; 
        end
        
     end
    
     
         %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-for further use create 2 auxiliary arraysREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
    clear Iexception1
    clear Iexception2
    
    %Consider the cases which are in the arena , not defined (1e6 coord
    %value) and negative or very big coordinates either x or y.Then in
    %arena is zero (we cannot say nothing
    Iexception1=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)))>2000 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    Iexception2=(abs(cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)))>2000 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j))==1 & cell2mat(MouseArray(2:length([CSVFile{2}])+1,25,j))==1);
    
    if ~isempty(find(Iexception1==1))
        MouseArray(Iexception1,12,j)=num2cell([0]);
    elseif ~isempty(find(Iexception2==1))
        MouseArray(Iexception2,12,j)=num2cell([0]);
        
    end
    
    
    %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
     
     
     
     
     
     
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-In Arena velocity with approximate real time REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
        RealTime=78; %Real time is 78ms
       if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
        InArenaVelocityR=InArenaobj.InArenaVelocityR(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2),RealTime,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
        MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(InArenaVelocityR);
       else
          MouseArray(2:length([CSVFile{2}])+1,34,j)=num2cell(0);  %for cases it is inside the cage all along the file
       end  
       
       
           %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDetermine when it is stop,running, walking according to the velocityREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH  
   
     InArenaVelocityRInterp=InArenaobj.InArenaVelocityRInterp(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));      
           
%      InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
    %InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,cell2mat(MouseArray(2:length([CSVFile{2}])+1,34,j)));
    
   InArenaActivity=InArenaobj.InArenaActivity(RepeatedFrames,InArenaVelocityRInterp,cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)));
    
    MouseArray(2:length([CSVFile{2}])+1,35,j)=num2cell(InArenaVelocityRInterp(:,1));%add to velocity interpolation where the velocity is zero
    MouseArray(2:length([CSVFile{2}])+1,36,j)=num2cell(InArenaActivity(:,1)); %stop
    MouseArray(2:length([CSVFile{2}])+1,37,j)=num2cell(InArenaActivity(:,2));%walking
    MouseArray(2:length([CSVFile{2}])+1,38,j)=num2cell(InArenaActivity(:,3));%running
       
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHDetermine if it is drinking or eatingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

   %First complete in all the repeated frames the velocities
   clear InArenaVelocityAllFrames;
   InArenaVelocityAllFrames=InArenaobj.InArenaVelocityAllFrames(RepeatedFrames,InArenaVelocityRInterp);

     IsEating=IsEatingDrinkingobj. IsEating(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);
     IsDrinking=IsEatingDrinkingobj. IsDrinking(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)),InArenaVelocityAllFrames);

    MouseArray(2:length([CSVFile{2}])+1,39,j)=num2cell(IsEating);%eating
    MouseArray(2:length([CSVFile{2}])+1,40,j)=num2cell(IsDrinking);%drinking
       
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Determine if it is inside or outside a given zoneREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

    IsZone=IsInZoneobj.IsZone(cell2mat(MouseArray(2:length([CSVFile{2}])+1,12,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,32,j)),cell2mat(MouseArray(2:length([CSVFile{2}])+1,33,j)));
   
    MouseArray(2:length([CSVFile{2}])+1,41,j)=num2cell(IsZone(:,1));%inner zone
    MouseArray(2:length([CSVFile{2}])+1,42,j)=num2cell(IsZone(:,2));%outside zone
       
       
       
    
    %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-for further use create 2 auxiliary arrays without repeatsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
        if ~isempty(find(cell2mat( MouseArray(2:length([CSVFile{2}])+1,12,j))==1)) 
         InArenaAuxiliary=InArenaobj.InArenaAuxiliary(RepeatedFrames,InArenaAddRepeats(:,1),InArenaAddRepeats(:,2));
       
         Distance(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,1);
         VectorX(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,2);%normalized vector
         VectorY(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,3);%normalized vector
         
         VectorX1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,4);
         VectorY1(1:length(RepeatedFrames)-1,j)=InArenaAuxiliary(:,5);
        else
           Distance(1:length(RepeatedFrames)-1,j)=0; %in the case it is inside all the time
           VectorX(1:length(RepeatedFrames)-1,j)=0;
           VectorY(1:length(RepeatedFrames)-1,j)=0;
           
           VectorX1(1:length(RepeatedFrames)-1,j)=0;
           VectorY1(1:length(RepeatedFrames)-1,j)=0;
            
        end
        
    %% 
    
 sheet=char(miceList(j));
 Namef=char(item_selected(i));
 filename=strcat(Namef(1:end-4),'LocomotionResults','.xlsx');
 filename=strrep(filename,'[','(');
  filename=strrep(filename,']',')');
  filename=strcat(Params.SaveDirectory,'\',filename);
 xlswrite(filename,MouseArray(:,:,j),sheet);
     else %if the mouse doesn't exit
  MouseArray(:,:,j)=num2cell([0]);
 
end 
 waitbar(j/length(miceList));
end
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Save the locomotion parameters as a structure bring  all the mice togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH



Locomotion.miceList=miceList;
Large=length(MouseArray(:,12,1));
Locomotion.isInArena=reshape(cell2mat(MouseArray(2:Large,12,:)),Large-1,length(miceList));
Locomotion.TrajectoryX=reshape(cell2mat(MouseArray(2:Large,32,:)),Large-1,length(miceList)); %coord after corrections with repeats
Locomotion.TrajectoryY=reshape(cell2mat(MouseArray(2:Large,33,:)),Large-1,length(miceList));  %coord after corrections with repeats
% Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,34,:)),Large-1,length(miceList)); %velocity of the real frames
Locomotion.Velocity=reshape(cell2mat(MouseArray(2:Large,35,:)),Large-1,length(miceList)); %velocity of the real frames including interpolation of zero points
Locomotion.InArenaDuplicates=reshape(cell2mat(MouseArray(2:Large,24,:)),Large-1,length(miceList)); %In arena duplicates

Locomotion.RepeatedFrames=RepeatedFrames;
Locomotion.ExperimentalTime=MouseArray(2:Large,2,1); %take only one mouse since it is the same time for everything.
Locomotion.VectorX=VectorX; %without repeats normalized
Locomotion.VectorY=VectorY; %without repeats normalized
Locomotion.Distance=Distance;%without repeats normalized
Locomotion.VectorX1=VectorX1; %without repeats no normalized
Locomotion.VectorY1=VectorY1; %without repeats no normalized

Locomotion.isStop=reshape(cell2mat(MouseArray(2:Large,36,:)),Large-1,length(miceList));
Locomotion.isWalking=reshape(cell2mat(MouseArray(2:Large,37,:)),Large-1,length(miceList));
Locomotion.isRunning=reshape(cell2mat(MouseArray(2:Large,38,:)),Large-1,length(miceList));

Locomotion.IsEating=reshape(cell2mat(MouseArray(2:Large,39,:)),Large-1,length(miceList));
Locomotion.IsDrinking=reshape(cell2mat(MouseArray(2:Large,40,:)),Large-1,length(miceList));
Locomotion.IsSleeping=reshape(cell2mat(MouseArray(2:Large,8,:)),Large-1,length(miceList));
Locomotion.IsHiding=reshape(cell2mat(MouseArray(2:Large,10,:)),Large-1,length(miceList));
Locomotion.SleepingBox=reshape(cell2mat(MouseArray(2:Large,9,:)),Large-1,length(miceList));
Locomotion.HidingBox=reshape(cell2mat(MouseArray(2:Large,11,:)),Large-1,length(miceList));
Locomotion.IsInsideZone=reshape(cell2mat(MouseArray(2:Large,41,:)),Large-1,length(miceList));
Locomotion.IsOutsideZone=reshape(cell2mat(MouseArray(2:Large,42,:)),Large-1,length(miceList));

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCompute distance pairsREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
 DistancePairs=computeDistancePairsGV(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.IsHiding,Locomotion.RepeatedFrames);
Locomotion.DistancePairs=DistancePairs;

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHCompute if the mice are togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Define object togetherREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
Togetherobj=Together;
Togetherobj.DistanceToBeTogether=Params.DistanceToBeTogheter; %distance to be considered together in general is 10cm
Togetherobj.numOfMice=length(Locomotion.miceList);

TogetherCalc=Togetherobj.TogetherCalc(Locomotion.TrajectoryX,Locomotion.TrajectoryY,Locomotion.isInArena,Locomotion.RepeatedFrames);
Locomotion.TimesTogether=TogetherCalc(1,length(Locomotion.miceList)+1);
Locomotion.TogetherAll=TogetherCalc(1,1:length(Locomotion.miceList));


%% 


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHSave as a mat fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
filename1=strcat(Namef(1:end-4),'.mat');
filename1=strcat(Params.SaveDirectory,'\',filename1);

save(filename1,'Locomotion')

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Calculating chasingREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Create chasing objectREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

Chasingobj=Chasing;
Chasingobj.numOfMice=length(Locomotion.miceList);
Chasingobj.Dist_tresh1=300;
Chasingobj.Velocity_Tresh=0.5;
Chasingobj.PathTresh=600;
Chasingobj.Dist_tresh2=200;

% Chasingobj.AngleMaximum1=20; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.
% Chasingobj.AngleMaximum2=20; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.
% Chasingobj.MinimumPath=200; %This is the minimum path recording to be considered as chasing.
% Chasingobj.GapPath=400; %This is the gap between the chasing that it is allow in units of mm
% Chasingobj.ThreshVelocity=10; %20-10 cm/sec
% Chasingobj.GapFrames=100; %maximum number of frames to be allowed to be a gap
% Chasingobj.GapPathEnd=200; %for the beginning and end of chasing interval



Chasingobj.AngleMaximum1=Params.AngleMaximum1; %This is the maximum angle, which is allowed, between the line joining the mice 1-2 and the vector of movement of mouse 1.
Chasingobj.AngleMaximum2=Params.AngleMaximum2; %This is the maximum angle, which is allowed, between the vector of movement of mouse 1 and mouse 2.
Chasingobj.MinimumPath=Params.editpar1; %This is the minimum path recording to be considered as chasing.
Chasingobj.GapPath=Params.editpar2; %This is the maximum distance allow to finish the chasing mm
Chasingobj.ThreshVelocity=Params.editpar3; %20-10 cm/sec
Chasingobj.GapFrames=Params.editpar4; %maximum number of frames to be allowed to be a gap
Chasingobj.GapPathEnd=Params.editpar5;

Chasingobj.GapFramesS=Params.editpar6; %maximum number of frames to be allowed to be a gap in small frames
Chasingobj.GapPathEndS=Params.editpar7;% condition of the end of the frame in small frames


%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Chasing after coord correctionREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-

TrajectoryX=Locomotion.TrajectoryX(Locomotion.RepeatedFrames,:);
TrajectoryY=Locomotion.TrajectoryY(Locomotion.RepeatedFrames,:);
Velocity=Locomotion.Velocity(Locomotion.RepeatedFrames,:);


% ChasingCal=Chasingobj.ChasingCal(TrajectoryX,TrajectoryY,Locomotion.Velocity(Locomotion.RepeatedFrames,:),Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.VectorX,Locomotion.VectorY,Locomotion.Distance,Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:))

 ChasingCalvs2=Chasingobj.ChasingCalvs2(TrajectoryX,TrajectoryY,Locomotion.VectorX1,Locomotion.VectorY1,Locomotion.isInArena(Locomotion.RepeatedFrames,:),Locomotion.RepeatedFrames,Velocity,Locomotion.InArenaDuplicates(Locomotion.RepeatedFrames,:));

% Locomotion.ChasingAll=ChasingCal(:,1:Chasingobj.numOfMice);
% Locomotion.ChasedAll=ChasingCal(:,Chasingobj.numOfMice+1:2*Chasingobj.numOfMice);
% Locomotion.MoveTogether=ChasingCal(:,2*Chasingobj.numOfMice+1:3*Chasingobj.numOfMice);
% Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);
Locomotion.ChasingAll=ChasingCalvs2(:,1:Chasingobj.numOfMice);
Locomotion.BeingChasingAll=ChasingCalvs2(:,Chasingobj.numOfMice+1:Chasingobj.numOfMice+Chasingobj.numOfMice);
Locomotion.TimeWithoutRepeats=Locomotion.ExperimentalTime(Locomotion.RepeatedFrames,:);







%% 


msgbox('Chasing analysis finish')


% %% %REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHSave as a mat fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
filename1=strcat(Namef(1:end-4),'.mat');
filename1=strcat(Params.SaveDirectory,'\',filename1);

save(filename1,'Locomotion');


%% 

 
msgbox('Finish')

%% 
%% 


end



%Results.miceList=miceList;
%Results.MouseArray=MouseArray;
 %save(mat according the date)



end

% %% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Arrange the chasing events into an excel file AGREGAR LO QUE FALTAREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% AllChasing=GetEvents;
% %%   %% save into an excel file in a sheet called list of all chasing events
%   raw={};
%   raw(1,1)={'Experiment date'};
%   raw(1,2)={'Time begin event'};
%   raw(1,3)={'Time end event'};
%   raw(1,4)={'Chasing mouse'};
%   raw(1,5)={'Chased mouse'};
%   raw(1,6)={'Corrected events'};
%   raw(1,7)={'Frame begin chasing'};
%   raw(1,8)={'Frame finish chasing'};
%   raw(1,9)={'Number of Event'};
%    
%   raw(2:size(AllChasing,1)+1,1:8)=AllChasing;
%    raw(2:size(AllChasing,1)+1,9)=num2cell([1:size(AllChasing,1)]');
% %   experi=get(h.editAllRFID2,'string');
%  % datadirec=get(h.edit3x,'string') %choice final sheet
% 
% %   DateOrder=OrderFilename(raw(2:end,1)); %order the first part of the date
% % [value,indexes]=sort(DateOrder,'ascend');
% % raw(2:length(DateOrder)+1,:)=raw(indexes+1,:);
% 
%   
%   
%   
%   %% 
%   
%   
%   sheet=['Chasing'];
%   xlswrite([Params.SaveDirectory,'\','ChasingResults.xlsx'],raw,sheet)
%close(hbar)

end


%% 


%% %% Auxiliary functions

function XY=rescaleCoordinatesGV(XY,Corners,max_width)
XY=(XY-repmat(Corners(1,:),size(XY,1),1))...,
    ./repmat(Corners(3,:)-Corners(1,:),size(XY,1),1)*max_width; % max_wd - mm

end 
%% find  the last numbers
function result=Find4last(x,a)
x=char(x);
T=strfind(x(end-6:end),a);
if isempty(T)
result=0;
else
result=1;
end
end
%% find RFID subset with the same date as the selected csv file
function IndexFilesDates=findRFIDSubset(FileSelected,DateFiles)
FileSelected=char(FileSelected);
Lim=strfind(FileSelected,'-');
x=datenum(FileSelected(1:Lim-1),'dd.mm.yyyy');
IndexFilesDates=find(DateFiles==x);

end 

%% Find the time near to the RFID data for each frame
function result=FoundNearTime(x,RFIDDataTime)

xTime=datevec(x,'HH:MM:SS.FFF');
TimeDif=abs(etime(RFIDDataTime,repmat(xTime,size(RFIDDataTime,1),1)));

%find the nearest time of rfid to frame video
result=find(TimeDif==min(TimeDif));
result=result(1);


end
%% Arrange the coordinates in an horizontal way

function [X,Y]=ArrangeHoriz(AuxArray,L)
X=[];
Y=[];
for j=1:L
     X=[X, AuxArray(:,1,j)];
     Y=[Y, AuxArray(:,2,j)];
end


end




%% To calculate distance between pair of mice-If one is in the arena/hiding or sleeping box  and vicevers  or both sleeping is NAN no information
%FOR THIS CALCULATION NO REPEATED WERE CONSIDERED
%THE DISTANCES WERE CALCULATED IN MM
function DistancePairs=computeDistancePairsGV(TrajectoryX,TrajectoryY,isInArena,IsHiding,RepeatedFrames)

%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHClear variablesREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-
a=[];
b=[];
c=[];
d=[];
%% 


numOfMice=size(TrajectoryX,2);
dist=@(x1,x2) sqrt(sum((x1-x2).^2,2));

%%
%Remove repeats
TrajectoryX=TrajectoryX(RepeatedFrames,:);
TrajectoryY=TrajectoryY(RepeatedFrames,:);
isInArena=isInArena(RepeatedFrames,:);
IsHiding=IsHiding(RepeatedFrames,:);


%% 

for i=1:numOfMice
    for j=1:numOfMice
        DistancePairs(:,i,j)=dist([TrajectoryX(:,i) TrajectoryY(:,i)],[TrajectoryX(:,j) TrajectoryY(:,j)]);
        
        a=~isInArena(:,i)&~isInArena(:,j);%both are not in arena
        c=~isInArena(:,i)&~IsHiding(:,i); %is not in the arena and it is not hiding
        d=~isInArena(:,j)&~IsHiding(:,j); %is not in the arena and it is not hiding
        
        DistancePairs(c|d,i,j)=NaN; %if one is in the arena and the other outiside or viceversa or both outside thus no information
        
       
%         b=(a==1) & (HidingBox(:,i)~=0) & (HidingBox(:,j)~=0) & (HidingBox(:,i)==HidingBox(:,j)); %if aren't in the arena and they are both in the hiding box thus the distance is zero
%              DistancePairs(b,i,j)=0;
        
    
        
        
    end
end

end
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-Function for saving Chasing, approachin/avoiding into an excel fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

function SaveSocialData(Social_Data,behaviour,SaveDirectory,exp_name,SocialObj)

if behaviour==1 %chasing
  %Separate the duplicates from the data and save in another sheet
  [Social_Data,DoubleData]=RemoveDuplicates(Social_Data);
  
  %% %%   %% save into an excel file in a sheet called list of all chasing events
  raw={};
  raw(1,1)={'Experiment date'};
  raw(1,2)={'Time begin event'};
  raw(1,3)={'Time end event'};
  raw(1,4)={'Chasing mouse'};
  raw(1,5)={'Chased mouse'};
  raw(1,6)={'Corrected events'};
  raw(1,7)={'Frame begin chasing'};
  raw(1,8)={'Frame finish chasing'};
  raw(1,9)={'Small Events'};
  raw(1,10)={'Number of Event'};
  
 % raw(2:size(Social_Data,1)+1,1:9)=Social_Data;
  
  %% Sort the data according to the days
  
  for i=1:length(Social_Data(:,1))
      Ax=char(strrep(Social_Data(i,1),'''','')); %remove every comma
    k=strfind(Ax,'_');
    
    formatIn = 'dd_mm_yyyy';
    DateString=Ax(1:k(3)-1);
    DateNum(i)=datenum(DateString,formatIn); %this is done if there was a change in month
    
  
end
 [~,idDateSort]=sort(DateNum); 
 Social_Data=Social_Data(idDateSort,:);
 
  raw(2:size(Social_Data,1)+1,1:9)=Social_Data; 
  %% 
  
  raw(2:size(Social_Data,1)+1,10)=num2cell([1:size(Social_Data,1)]');
  
  sheet=['Chasing'];
  xlswrite([SaveDirectory,'\',exp_name,'_','ChasingResults.xlsx'],raw,sheet)
  
    %% Save in another sheet data which appear as duplicate and it is not sure
  
  raw1={};
  raw1(1,1)={'Experiment date'};
  raw1(1,2)={'Time begin event'};
  raw1(1,3)={'Time end event'};
  raw1(1,4)={'Chasing mouse'};
  raw1(1,5)={'Chased mouse'};
  raw1(1,6)={'Corrected events'};
  raw1(1,7)={'Frame begin chasing'};
  raw1(1,8)={'Frame finish chasing'};
  raw1(1,9)={'Small Events'};
  raw1(1,10)={'Number of Event'};
   
  raw1(2:size(DoubleData,1)+1,1:9)=DoubleData;
  
  raw1(2:size(DoubleData,1)+1,10)=num2cell([1:size(DoubleData,1)]');
  
  sheet1=['ChasingNoDefinedData'];
  xlswrite([SaveDirectory,'\',exp_name,'_','ChasingResults.xlsx'],raw1,sheet1)
  
    %% Save in another sheet all the parameters
  raw2={};
  raw2(1,1)={'Angle of 1-2 with movement 1 (degree)'};
  raw2(2,1)={'Angle of movement 1 with movement 2 (degree)'};
  raw2(3,1)={'Minimum path done by the mouse to be considered chasing (mm)'};
  raw2(4,1)={'Maximum distance between mice allow in a chasing event (mm)'};
  raw2(5,1)={'Minimum velocity to be considered in a chasing event (cm/sec)'};
  raw2(6,1)={'Maximum number of frames  between events allow to join between them'};
  raw2(7,1)={'Maximum mice distance between events allow to join events(mm)'};
  raw2(8,1)={'Maximum number of frames  between SMALL events allow to join between them'};
  raw2(9,1)={'Maximum mice distance between SMALL events allow to join events (mm)'};
  
   raw2(1,2)=num2cell(SocialObj.AngleMaximum1);
  raw2(2,2)=num2cell(SocialObj.AngleMaximum2);
  raw2(3,2)=num2cell(SocialObj.MinimumPath);
  raw2(4,2)=num2cell(SocialObj.GapPath);
  raw2(5,2)=num2cell(SocialObj.ThreshVelocity);
  raw2(6,2)=num2cell(SocialObj.GapFrames);
  raw2(7,2)=num2cell(SocialObj.GapPathEnd);
  raw2(8,2)=num2cell(SocialObj.GapFramesS);
  raw2(9,2)=num2cell(SocialObj.GapPathEndS);
  
  
 sheet2=['ChasingParameters'];
  xlswrite([SaveDirectory,'\',exp_name,'_','ChasingResults.xlsx'],raw2,sheet2)
  
elseif behaviour==2 %avoiding
    
      %% %%   %% save into an excel file in a sheet called list of all avoiding events
  raw={};
  raw(1,1)={'Experiment date'};
  raw(1,2)={'Time begin event'};
  raw(1,3)={'Time end event'};
  raw(1,4)={'Avoiding mouse'};
  raw(1,5)={'Being avoiding mouse'};
  raw(1,6)={'Corrected events'};
  raw(1,7)={'Frame begin avoiding'};
  raw(1,8)={'Frame finish avoiding'};
  raw(1,9)={'Number of Event'};
  
  raw(2:size(Social_Data,1)+1,1:8)=Social_Data;
  raw(2:size(Social_Data,1)+1,9)=num2cell([1:size(Social_Data,1)]');
  
  sheet=['Avoiding'];
  xlswrite([SaveDirectory,'\',exp_name,'_','AvoidingResults.xlsx'],raw,sheet)
    
 %Save in another sheet all the parameters
  raw2={};
  raw2(1,1)={'Max. distance between mice to be considered avoiding event(mm)'};
  raw2(2,1)={'Fine tuning of the distance for avoiding event (mm)'};
  raw2(3,1)={'Velocity of avoiding (cm/sec)'};
  raw2(4,1)={'Radius for avoiding (mm)'};

  
   raw2(1,2)=num2cell(SocialObj.Distance_thresh);
  raw2(2,2)=num2cell(SocialObj.Dist_thresh_Fine_Tuning);
  raw2(3,2)=num2cell(SocialObj.velThr);
  raw2(4,2)=num2cell(SocialObj.R);
 
  
  
 sheet2=['AvoidingParameters'];
  xlswrite([SaveDirectory,'\',exp_name,'_','AvoidingResults.xlsx'],raw2,sheet2)  
    
    
    
    
    
elseif behaviour==3 %approaching   
    
        %% %%   %% save into an excel file in a sheet called list of all approaching events
  raw={};
  raw(1,1)={'Experiment date'};
  raw(1,2)={'Time begin event'};
  raw(1,3)={'Time end event'};
  raw(1,4)={'Approaching mouse'};
  raw(1,5)={'Be approached mouse'};
  raw(1,6)={'Corrected events'};
  raw(1,7)={'Frame begin approaching'};
  raw(1,8)={'Frame finish approaching'};
  raw(1,9)={'Number of Event'};
  
  raw(2:size(Social_Data,1)+1,1:8)=Social_Data;
  raw(2:size(Social_Data,1)+1,9)=num2cell([1:size(Social_Data,1)]');
  
  sheet=['Approaching'];
  xlswrite([SaveDirectory,'\',exp_name,'_','ApproachingResults.xlsx'],raw,sheet)
    
 %Save in another sheet all the parameters
  raw2={};
  raw2(1,1)={'Max. distance between mice to be considered approaching event(mm)'};
  raw2(2,1)={'Fine tuning of the distance for approaching event (mm)'};
  raw2(3,1)={'Velocity of the approached mouse (cm/sec)'};
  raw2(4,1)={'Correlation factor between mice'};

  
  raw2(1,2)=num2cell(SocialObj.Distance_thresh);
  raw2(2,2)=num2cell(SocialObj.distTr);
  raw2(3,2)=num2cell(SocialObj.velTr2);
  raw2(4,2)=num2cell(SocialObj.CorrelFactor);
 
  
  
 sheet2=['ApproachingParameters'];
  xlswrite([SaveDirectory,'\',exp_name,'_','ApproachingResults.xlsx'],raw2,sheet2)  
    
end




end
%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH-For removing duplicates from excel fileREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
function [Social_Data,DoubleData]=RemoveDuplicates(Social_Data)

   BegFrameEndFrame=cell2mat(Social_Data(:,7:8));
   A=[1:length(BegFrameEndFrame(:,1))]'; 
   [C,ia,ic]=unique(BegFrameEndFrame,'rows','stable');%eliminate the duplicates
   IndWithDuplicates=setdiff(A,ia,'rows');
   Duplicates=BegFrameEndFrame(IndWithDuplicates,:);
   Lia=ismember(BegFrameEndFrame,Duplicates,'rows');%find this duplicates in original data
   AuxData=Social_Data(find(Lia(:,1)==1),:);%this is data of duplicates
   Iaux=find(Lia(:,1)==1);
   Iaux1=setdiff(A,Iaux,'rows');
   DoubleData=Social_Data(Iaux,:);
   Social_Data=Social_Data(Iaux1,:);



end





##### SOURCE END #####
--></body></html>